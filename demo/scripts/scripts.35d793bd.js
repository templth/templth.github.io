function createPromise(a,b,c){var d=a.defer();return b(function(){d.resolve(c)},50),d.promise}function generateUuid(a){return a.generate()}function copySamples(a,b,c){var d=c["get"+a+"Samples"]();_.forEach(d,function(a){_.some(b,"id",a.id)||b.push(a)})}function createInMemoryPersistenceService(a,b,c,d,e){var f={},g=_.capitalize(a)+"s",h=_.capitalize(a),i=[];return copySamples(h,i,e),f["get"+g]=function(){var d=i;if("layer"===a&&1===arguments.length){var e=arguments[0];d=_.filter(d,function(a){return _.includes(a.maps,e)})}return createPromise(b,c,d)},f["add"+h]=function(a){return a.id=generateUuid(d),i.push(a),createPromise(b,c,a)},f["get"+h]=function(a){return createPromise(b,c,_.find(i,"id",a))},f["save"+h]=function(a){var d=_.find(i,"id",a.id);return _.assign(d,a),createPromise(b,c,d)},f["delete"+h]=function(a){return _.remove(i,function(b){return b.id===a}),createPromise(b,c)},f}function createLocalStoragePersistenceService(a,b,c,d,e,f){var g={},h=a+"s",i=_.capitalize(a)+"s",j=_.capitalize(a);return d[h]=[],g["get"+i]=function(){var e=d[h],f=e;if("layer"===a&&1===arguments.length){var g=arguments[0];f=_.filter(f,function(a){return _.includes(a.maps,g)})}return createPromise(b,c,f)},g["add"+j]=function(a){var f=d[h];return a.id=generateUuid(e),f.push(a),createPromise(b,c,a)},g["get"+j]=function(a){var e=d[h];return createPromise(b,c,_.find(e,"id",a))},g["save"+j]=function(a){var e=d[h],f=_.find(e,"id",a.id);return _.assign(f,a),createPromise(b,c,f)},g["delete"+j]=function(a){var e=d[h];return _.remove(e,function(b){return b.id===a}),createPromise(b,c)},g}function createAuthorizationHeader(a){return"Basic "+btoa(a.username+":"+a.password)}function createWebApiPersistenceService(a,b,c){var d={},e=a+"s",f=_.capitalize(a)+"s",g=_.capitalize(a);return d["get"+f]=function(){var d=c.getCurrentProvider(),f={headers:{}};return d.secured&&(f.headers.Authorization=createAuthorizationHeader(d)),"layer"===a&&(f.params={maps:arguments[0],$sort:"rank ASC"}),b.get(d.url+e+"/",f).then(function(a){return a.data})},d["add"+g]=function(a){delete a.id;var d=c.getCurrentProvider();return b.post(d.url+e+"/",a,{headers:{Authorization:createAuthorizationHeader(d)}}).then(function(a){return a.data})},d["get"+g]=function(a){var d=c.getCurrentProvider(),f={headers:{}};return d.secured&&(f.headers.Authorization=createAuthorizationHeader(d)),b.get(d.url+e+"/"+a,f).then(function(a){return a.data})},d["save"+g]=function(a){var d=c.getCurrentProvider();return b.put(d.url+e+"/"+a.id,a,{headers:{Authorization:createAuthorizationHeader(d)}}).then(function(a){return a.data})},d["delete"+g]=function(a){var d=c.getCurrentProvider();return b["delete"](d.url+e+"/"+a,{headers:{Authorization:createAuthorizationHeader(d)}})},d}function createPersistenceService(a,b,c,d,e){var f={},g=_.capitalize(a)+"s",h=_.capitalize(a);return f["get"+g]=function(){return b.isInMemoryCurrentProvider()?c["get"+g].apply(c,arguments):b.isBrowserStorageCurrentProvider()?d["get"+g].apply(c,arguments):b.isWebApiCurrentProvider()?e["get"+g].apply(c,arguments):void 0},f["add"+h]=function(a){return b.isInMemoryCurrentProvider()?c["add"+h].apply(c,arguments):b.isBrowserStorageCurrentProvider()?d["add"+h].apply(c,arguments):b.isWebApiCurrentProvider()?e["add"+h].apply(c,arguments):void 0},f["get"+h]=function(a){return b.isInMemoryCurrentProvider()?c["get"+h].apply(c,arguments):b.isBrowserStorageCurrentProvider()?d["get"+h].apply(c,arguments):b.isWebApiCurrentProvider()?e["get"+h].apply(c,arguments):void 0},f["save"+h]=function(a){return b.isInMemoryCurrentProvider()?c["save"+h].apply(c,arguments):b.isBrowserStorageCurrentProvider()?d["save"+h].apply(c,arguments):b.isWebApiCurrentProvider()?e["save"+h].apply(c,arguments):void 0},f["delete"+h]=function(a){return b.isInMemoryCurrentProvider()?c["delete"+h].apply(c,arguments):b.isBrowserStorageCurrentProvider()?d["delete"+h].apply(c,arguments):b.isWebApiCurrentProvider()?e["delete"+h].apply(c,arguments):void 0},f}angular.module("app.config",[]).constant("environment","NO_ENV").constant("appVersion","0.1.0").constant("addSamples",!0).constant("storageType","inmemory").constant("apiBaseUrl",""),angular.module("mapManager.errors",[]).factory("errorsHandler",["$q","$location",function(a,b){return{responseError:function(c){var d=c.status;return(401===d||403===d)&&b.path("/providers"),a.reject(c)}}}]),angular.module("d3",[]).factory("d3Service",function(){return d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3}).service("d3Helper",["d3Service",function(a){return{interpolatedProjection:function(b,c){function d(a,d){var f=b([a*=180/Math.PI,d*=180/Math.PI]),g=c([a,d]);return[(1-e)*f[0]+e*g[0],(e-1)*f[1]-e*g[1]]}var e,f=a.geo.projection(d).scale(1),g=f.center,h=f.translate;return f.alpha=function(a){if(!arguments.length)return e;e=+a;var d=b.center(),i=c.center(),j=b.translate(),k=c.translate();return g([(1-e)*d[0]+e*i[0],(1-e)*d[1]+e*i[1]]),h([(1-e)*j[0]+e*k[0],(1-e)*j[1]+e*k[1]]),f},delete f.scale,delete f.translate,delete f.center,f.alpha(0)},trackballAngles:function(a,b){var c=a.scale(),d=a.translate(),e=b[0]-d[0],f=-(b[1]-d[1]),g=e*e+f*f,h=c*c>2*g?Math.sqrt(c*c-g):c*c/2/Math.sqrt(g),i=180*Math.atan2(e,h)/Math.PI,j=180*Math.atan2(f,h)/Math.PI;return[i,j]},composedRotation:function(a,b,c,d,e){var f,g,h;a=Math.PI/180*a,b=Math.PI/180*b,c=Math.PI/180*c,d=Math.PI/180*d,e=Math.PI/180*e;var i=Math.sin(a),j=Math.sin(b),k=Math.sin(c),l=Math.sin(d),m=Math.sin(e),n=Math.cos(a),o=Math.cos(b),p=Math.cos(c),q=Math.cos(d),r=Math.cos(e),s=-l*i*o+(k*i*j+p*n)*q,t=-k*q*o-l*j,u=-m*i*q*o-(k*i*j+p*n)*l*m-(i*j*p-k*n)*r,v=l*m*k*o-m*j*q+r*p*o,w=-i*q*r*o-(k*i*j+p*n)*l*r+(i*j*p-k*n)*m,x=l*k*r*o-m*p*o-j*q*r,y=q*r*n*o+(k*j*n-i*p)*l*r-(j*p*n+k*i)*m;return 0!==t||0!==v?(f=Math.atan2(-t,v),g=Math.atan2(-x,0===Math.sin(f)?v/Math.cos(f):-t/Math.sin(f)),h=Math.atan2(-w,y)):(f=Math.atan2(u,s)-x*a,g=-x*Math.PI/2,h=a),[180*h/Math.PI,180*g/Math.PI,180*f/Math.PI]},updateMapElements:function(b,c,d){function e(a){return _.isNull(a)?c([0,0])[0]:c([a.lon,a.lat])[0]}function f(a){return _.isNull(a)?c([0,0])[1]:c([a.lon,a.lat])[1]}_.forEach(d,function(d){if("path"===d.type){var g=a.geo.path().projection(c);a.select("#"+b+"-layers").selectAll("path").attr("d",g)}else"circle"===d.type&&a.select("#"+b+"-layers").selectAll("circle").attr("cx",e).attr("cy",f)})}}}]),angular.module("mapManager.utilities",[]).service("valueChecker",function(){return{isNotNaN:function(a){return!_.isNaN(a)},isNull:function(a){return _.isUndefined(a)||_.isNull(a)},isNullOrEmpty:function(a){return this.isNull(a)||_.isEmpty(a)},isNotNull:function(a){return!_.isUndefined(a)&&!_.isNull(a)},isNotNullAndNotEmpty:function(a){return this.isNotNull(a)&&!_.isEmpty(a)}}}).service("propertiesHelper",["valueChecker",function(a){return{getDomainEvents:function(b,c){var d=this;if(a.isNotNull(b.behavior)&&a.isNotNull(b.behavior.events)){var e={};return _.forEach(b.behavior.events,function(a,f){if(d.isSupportedEvent(f)){var g=b.behavior.events[f],h=null;h=_.isArray(g)?g:[g],_.forEach(h,function(a){a.display===c&&(e.display=f),a.hide===c&&(e.hide=f)})}}),a.isNull(e.display)&&a.isNull(e.hide)?null:e}return null},isSupportedEvent:function(a){return"click"===a||"dblclick"===a||"mouseover"===a||"mouseout"===a},hasPropertyConfigured:function(b,c,d){return a.isNotNull(b[c])&&a.isNotNull(b[c][d])}}}]).service("mapHelper",["valueChecker",function(a){return{createSubMapStructure:function(a,b,c,d){return this.createMapStructure(a,b,{dimensions:c,background:d})},createMainMapStructure:function(a){return this.createMapStructure(a,"1")},createMapStructure:function(b,c,d){var e=b.append("g").attr("id","map"+c);a.isNotNull(d)&&a.isNotNull(d.dimensions)&&a.isNotNull(d.background)&&e.append("rect").attr("width",d.dimensions.width).attr("height",d.dimensions.height).attr("id","rect"+c).style("fill",d.background.fill).style("opacity",d.background.opacity);var f=e.append("g").attr("id","map"+c+"-layers");return{gMap:e,gLayers:f}},getMapElements:function(){return[{type:"path"},{type:"circle"},{type:"LineString"}]}}}]).service("typeHelper",["valueChecker",function(a){return{isIntegerNumber:function(a){return a%1===0},isIntegerValue:function(b){return _.isNumber(b)&&this.isIntegerNumber(b)?!0:a.isNotNaN(parseInt(b))},parseIntegerValue:function(a){return parseInt(a)},isFloatValue:function(b){return _.isNumber(b)&&!this.isIntegerNumber(b)?!0:a.isNotNaN(parseFloat(b))},parseFloatValue:function(a){return parseFloat(a)},isBooleanValue:function(a){return _.isBoolean(a)?!0:"true"===a||"false"===a},parseBooleanValue:function(a){return"true"===a},isDateValue:function(b){return _.isDate(b)?!0:a.isNotNaN(new Date(b))},parseDateValue:function(a){return new Date(a)},getType:function(a){return this.isIntegerValue(a)?"integer":this.isFloatValue(a)?"float":_.isBoolean(a)?"boolean":_.isDate(a)?"date":"string"}}}]).service("svgHelper",["d3Service",function(a){return{removeSvgElement:function(b){var c=a.select(b[0]).select("svg");c.empty()||a.select(b[0]).select("svg").select("*").remove()},createSvgElement:function(b,c,d,e,f){var g=a.select(b[0]).select("svg");if(g.empty()){var h=a.select(b[0]).append("svg").attr("preserveAspectRatio","xMidYMid").attr("viewBox","0 0 "+c+" "+d).attr("width",e).attr("height",e*d/c);return h.append("rect").attr("class","background").attr("width",c).attr("height",d),h}return g}}}]),angular.module("mapManager.console",[]).service("consoleService",function(){return{messages:[],logMessage:function(a,b){this.messages.unshift({level:a,description:b})},clearMessages:function(){this.messages=[]}}}),angular.module("mapManager.map",["mapManager.d3.services","mapManager.persistence"]).service("currentMapService",function(){return{currentMapId:"map1",currentMapNumber:1,currentMapElement:null,currentMap:null,currentMapContext:{},setCurrentMapElement:function(a){this.currentMapElement=a},getCurrentMapElement:function(){return this.currentMapElement},getCurrentMapId:function(){return this.currentMapId},setCurrentMapId:function(a){this.currentMapId=a},getCurrentMap:function(){return this.currentMap},setCurrentMap:function(a){this.currentMap=a},registerCurrentMapContext:function(a,b,c,d,e,f){null==this.currentMapContext[this.currentMapId]&&(this.currentMapContext[this.currentMapId]={}),this.currentMapContext[this.currentMapId].svg=a,this.currentMapContext[this.currentMapId].path=b,this.currentMapContext[this.currentMapId].projection=c,this.currentMapContext[this.currentMapId].gMap=d,this.currentMapContext[this.currentMapId].gLayers=e,this.currentMapContext[this.currentMapId].dimensions=f},getCurrentMapContext:function(){return null==this.currentMapContext[this.currentMapId]&&(this.currentMapContext[this.currentMapId]={}),this.currentMapContext[this.currentMapId]},configureMapResize:function(a,b){a.getElementDimensions=function(){return{h:b.height(),w:b.width()}},a.$watch(a.getElementDimensions,function(a,b){},!0),b.bind("resize",function(){a.$apply()})}}}).service("mapsService",["$route","mapResource","layerResource",function(a,b,c){return{resolveMaps:function(){return b.getMaps()},resolveCurrentMap:function(){var c=a.current.params.mapId;return b.getMap(c)},resolveCurrentMapLayers:function(){var b=a.current.params.mapId;return c.getLayers(b)},getCurrentMap:function(){var c=a.current.params.mapId;return b.get({mapId:c})}}}]),angular.module("mapManager.source",["mapManager.persistence"]).service("sourcesService",["$route","sourceResource",function(a,b){return{resolveSources:function(){return b.getSources()},resolveSource:function(){var c=a.current.params.sourceId;return b.getSource(c)},getCurrentSource:function(){var c=a.current.params.sourceId;return b.getSource(c)}}}]),angular.module("mapManager.samples",[]).service("samplesService",function(){return{getMapSamples:function(){var a=[];return a.push(this.getMapSample1()),a.push(this.getMapSample2()),a.push(this.getMapSample3()),a},getMapSample1:function(){var a=this.getSourcesSample1();return{id:"1",name:"Meteorites",type:"d3js",projection:"orthographic",scale:420,center:{lon:60,lat:-30},interactions:{moving:"mouseMove",zooming:"mouseWheel"},sources:a}},getMapSample2:function(){var a=this.getSourcesSample2();return{id:"2",name:"US unemployment",type:"d3js",projection:"orthographic",scale:420,center:{lon:102,lat:-47},interactions:{moving:"mouseMove",zooming:"mouseWheel"},sources:a}},getMapSample3:function(){var a=this.getSourcesSample2();return{id:"3",name:"US unemployment (1)",type:"d3js",projection:"orthographic",scale:420,center:{lon:102,lat:-47},interactions:{moving:"mouseMove",zooming:"mouseWheel"},sources:a}},getLayerSamples:function(){var a=[],b=this.getLayersSample1();_.forEach(b,function(b){a.push(b)});var c=this.getLayersSample2();_.forEach(c,function(b){a.push(b)});var d=this.getLayersSample3();return _.forEach(d,function(b){a.push(b)}),a},getLayersSample1:function(){return[{id:"graticuleLayer",type:"graticule",rank:1,name:"Graticule",applied:!0,visible:!0,maps:["1"],display:{background:!0,lines:!0,border:!0},styles:{background:{fill:"#a4bac7"},border:{stroke:"#000",strokeWidth:"3px"},lines:{stroke:"#777",strokeWidth:".5px",strokeOpacity:".5"}}},{id:"worldLayer",type:"geodata",rank:2,name:"World",applied:!0,visible:!0,maps:["1"],data:{url:'"http://localhost:9000/scripts/json/continent.json"',rootObject:"countries",type:"topojson",source:"continents-source",content:[],loaded:!1},display:{fill:{categorical:{name:"category20b",value:"i"}},bounds:{applyIf:""},tooltip:{enabled:!0,fromScale:300,text:'"Name: "+d.properties.name'},subMap:{layers:["cities-country","meteorites-country"],variables:["bounds","shape"],legend:{label:"shape.properties.name"}}},styles:{background:{fill:"#ff0000"},lines:{stroke:"#fff",strokeWidth:"1px",strokeOpacity:"1"}},behavior:{events:{click:[{display:"subMap"}],mouseover:{display:"tooltip"},mouseout:{hide:"tooltip"}}}},{id:"meteorites",type:"data",mode:"objects",rank:6,maps:["1"],data:{url:'"http://localhost:9000/scripts/json/Meteorite_Landings.csv"',type:"csv",source:"meteorites-source",content:[],loaded:!1,id:"name",where:"d.mass > 10000",order:{field:"mass",ascending:!1}},name:"Meteorites",display:{shape:{type:"circle",radius:"d.mass / 5000000",origin:"[ d.reclong, d.reclat ]",opacity:.75,threshold:{paletteCode:"YlOrRd",paletteReverse:!1,values:[1800,1900,1950,2e3,2015],colors:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"]},value:"parseDate(d.year).getFullYear()"},legend:{enabled:!0,label:"d"},tooltip:{enabled:!0,fromScale:300,text:'"Name: "+d.name+"<br/>Year: "+parseDate(d.year).getFullYear()+"<br/>Mass: "+d.mass/1000+" kg"'}},behavior:{events:{click:[{display:"tooltip"}]}},applied:!0,visible:!0},{id:"meteorites-country",type:"data",mode:"objects",rank:7,maps:["1"],data:{url:'"http://localhost:9000/scripts/json/Meteorite_Landings.csv"',type:"csv",source:"meteorites-source",content:[],loaded:!1,id:"name",where:"d.mass < 100000 && isInBounds([d.reclong, d.reclat], bounds)",order:{field:"mass",ascending:!1}},name:"Meteorites (Country)",display:{shape:{type:"circle",radius:"d.mass / 50000",origin:"[ d.reclong, d.reclat ]",opacity:.75,threshold:{paletteCode:"YlOrRd",paletteReverse:!1,values:[1800,1900,1950,2e3,2015],colors:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"]},value:"parseDate(d.year).getFullYear()"},legend:{enabled:!0,label:"d"},tooltip:{enabled:!0,fromScale:300,text:'"Name: "+d.name+"<br/>Year: "+parseDate(d.year).getFullYear()+"<br/>Mass: "+d.mass/1000+" kg"'}},behavior:{animation:{value:"parseDate(d.year).getFullYear()",startValue:1950,ascending:!0,interval:500,showAllAtEnd:!0,label:'"Year: "+d'},events:{click:[{display:"tooltip"}]}},applied:!1,visible:!1},{id:"cities-country",type:"data",mode:"objects",rank:6,maps:["1"],data:{inline:'[{name: "Paris", lat: 48.50, lon: 2.20 }]',content:[],loaded:!1,id:"name",where:"isInBounds([d.lon, d.lat], bounds)"},name:"Cities (Country)",display:{shape:{type:"circle",radius:".2",origin:"[ d.lon, d.lat ]",opacity:.75,color:"black",label:{text:"d.name",position:{x:5,y:5}}}},applied:!1,visible:!1},{id:"images",type:"data",mode:"objects",rank:6,maps:["1"],data:{inline:'[{name: "Paris", lat: 48.50, lon: 2.20 }]',content:[],loaded:!1,id:"name"},name:"Cities (Country)",display:{shape:{type:"image",radius:".2",origin:"[ d.lon, d.lat ]",opacity:.75,color:"black",label:{text:"d.name",position:{x:5,y:5}}}},applied:!0,visible:!0},{id:"test",type:"data",mode:"objects",rank:6,maps:["1"],data:{inline:"[{ points: [ {lon: -74.007124, lat: 40.71455}, {lon: -118.245323, lat: 34.05349}, { lon: -92.888759, lat: 45.37399} ] }] "},name:"Test line",display:{shape:{type:"line",value:"d.points",pointValue:"[d.lon, d.lat]"}},styles:{lines:{stroke:"#f00",strokeWidth:"1px"}},applied:!0,visible:!0},{id:"race",type:"data",mode:"objects",rank:6,maps:["1"],data:{url:'"http://localhost:9000/scripts/json/M50_08.json"',type:"json",source:"meteorites-source",formatDataAsArray:!0,content:[],loaded:!1},name:"Race",display:{shape:{type:"line",value:"d",pointValue:"[d.lon_dec, d.lat_dec]"}},styles:{lines:{stroke:"#f00",strokeWidth:"1px"}},applied:!0,visible:!0}]},getLayersSample2:function(){return[{id:"graticuleLayer2",type:"graticule",rank:1,name:"Graticule",applied:!0,visible:!0,maps:["2"],display:{background:!0,lines:!0,border:!0},styles:{background:{fill:"#a4bac7"},border:{stroke:"#000",strokeWidth:"3px"},lines:{stroke:"#777",strokeWidth:".5px",strokeOpacity:".5"}}},{id:"usCounties",type:"geodata",rank:4,maps:["2"],data:{source:"us-counties",url:'"http://localhost:9000/scripts/json/us/us-counties.json"',properties:{url:'"http://localhost:9000/scripts/json/us/us-county-names2.csv"',type:"csv"},rootObject:"counties",type:"topojson",content:[],loaded:!1},display:{tooltip:{enabled:!0,fromScale:300,text:'"Name: "+d.properties.name+"<br/>State: "+d.properties.stateName+"("+d.properties.stateCode+")"'}},styles:{path:{fill:"none",stroke:"#fff",strokeLinejoin:"round",strokeLinecap:"round"},d:{strokeWidth:"0.5px"}},behavior:{events:{mouseover:{display:"tooltip"},mouseout:{hide:"tooltip"}}},name:"US counties",applied:!0,visible:!0},{id:"layer22",type:"data",mode:"fill",rank:7,maps:["2"],data:{source:"us-unemployment",url:'"http://localhost:9000/scripts/json/unemployment.tsv"',type:"tsv",content:[],loaded:!1},name:"Unemployment rate",display:{fill:{threshold:{paletteCode:"Purples",paletteReverse:!1,values:[.02,.04,.06,.08,.1],colors:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"]},value:"d.rate"},legend:{enabled:!0,label:'(d * 100) + " %"'},tooltip:{enabled:!0,fromScale:300,text:'"Value: "+value'}},styles:{legend:{},tooltip:{}},behavior:{tooltip:{display:"mouseOver",hide:"mouseOut"}},applyOn:"usCounties",applied:!0,visible:!0}]},getLayersSample3:function(){return[{id:"graticuleLayer3",type:"graticule",rank:1,name:"Graticule",applied:!0,visible:!0,maps:["3"],display:{background:!0,lines:!0,border:!0},styles:{background:{fill:"#a4bac7"},border:{stroke:"#000",strokeWidth:"3px"},lines:{stroke:"#777",strokeWidth:".5px",strokeOpacity:".5"}}},{id:"usStates3",type:"geodata",rank:4,maps:["3"],data:{source:"us-counties",url:'"http://localhost:9000/scripts/json/us/us-counties.json"',properties:{url:'"http://localhost:9000/scripts/json/us/us-state-names1.csv"',type:"csv"},rootObject:"states",type:"topojson",content:[],loaded:!1},display:{fill:{categorical:{name:"category20b",value:"i"}},tooltip:{enabled:!0,fromScale:300,text:'"Name: "+d.properties.name+" ("+d.properties.code+")"'},subMap:{layers:["usCounties3","layer223","usCities"],variables:["bounds","shape"],legend:{label:'shape.properties.name+" ("+shape.properties.code+")"'}}},styles:{path:{fill:"none",stroke:"#fff",strokeLinejoin:"round",strokeLinecap:"round"},d:{strokeWidth:"0.5px"}},behavior:{events:{click:{display:"subMap"},mouseover:{display:"tooltip"},mouseout:{hide:"tooltip"}}},name:"US states",applied:!0,visible:!0},{id:"usCounties3",type:"geodata",rank:4,maps:["3"],data:{source:"us-counties",url:'"http://localhost:9000/scripts/json/us/us-counties.json"',properties:{url:'"http://localhost:9000/scripts/json/us/us-county-names2.csv"',type:"csv"},rootObject:"counties",type:"topojson",where:"shape.properties.code === d.properties.stateCode",content:[],loaded:!1},display:{tooltip:{enabled:!0,fromScale:300,text:'"Name: "+d.properties.name+" ("+d.properties.stateCode+")"'}},styles:{path:{fill:"none",stroke:"#fff",strokeLinejoin:"round",strokeLinecap:"round"},d:{strokeWidth:"0.5px"}},name:"US counties",applied:!1,visible:!1},{id:"layer223",type:"data",mode:"fill",rank:7,maps:["3"],data:{source:"us-unemployment",url:'"http://localhost:9000/scripts/json/unemployment.tsv"',type:"tsv",content:[],loaded:!1},name:"Unemployment rate",display:{fill:{threshold:{paletteCode:"Purples",paletteReverse:!1,values:[.02,.04,.06,.08,.1],colors:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"]},value:"d.rate"},legend:{enabled:!0,label:'(d * 100) + " %"'},tooltip:{enabled:!0,fromScale:300,text:'d.properties.name+" ("+d.properties.stateCode+")<br/>Rate: "+formatNumber(value*100, 2)+"%"'}},styles:{legend:{},tooltip:{}},behavior:{events:{mouseover:{display:"tooltip"},mouseout:{hide:"tooltip"}}},applyOn:"usCounties3",applied:!1,visible:!1},{id:"usCities",type:"data",mode:"objects",rank:6,maps:["3"],data:{url:'"http://localhost:9000/scripts/json/us/us-main-cities.csv"',type:"csv",content:[],loaded:!1,id:"name",where:"shape.properties.code === d.stateCode && isInBounds([d.lon, d.lat], bounds)"},name:"Cities (Country)",display:{shape:{type:"circle",radius:".1",origin:"[ d.lon, d.lat ]",opacity:.75,color:"gray"},tooltip:{enabled:!0,fromScale:300,text:"d.name"}},behavior:{events:{mouseover:{display:"tooltip"},mouseout:{hide:"tooltip"}}},applied:!1,visible:!1}]},getSourceSamples:function(){var a=[],b=this.getSourcesSample1();_.forEach(b,function(b){a.push(b)});var c=this.getSourcesSample2();return _.forEach(c,function(b){a.push(b)}),a},getSourcesSample1:function(){return[{id:"meteorites-source",name:"List of meteorites",type:"data",url:"http://localhost:9000/scripts/json/Meteorite_Landings.csv",dataType:"csv",structure:'[\n  "name",\n  "id",\n  "nametype",\n  "recclass",\n  "mass",\n  "fall",\n  "year",\n  "reclat",\n  "reclong",\n  "GeoLocation"\n]',rowNumber:45716,minMax:'{\n  "id": [\n    "1",\n    "57458"\n  ],\n  "mass": [\n    "0.5",\n    "60000000"\n  ],\n  "year": [\n    "01/01/1880 12:00:00 AM",\n    "12/24/1399 12:00:00 AM"\n  ],\n  "reclat": [\n    "-87.366670",\n    "81.166670"\n  ],\n  "reclong": [\n    "-165.116670",\n    "354.473330"\n  ]\n}',sample:'[\n  {\n    "name": "Aachen",\n    "id": "1",\n    "nametype": "Valid",\n    "recclass": "L5",\n    "mass": "21",\n    "fall": "Fell",\n    "year": "01/01/1880 12:00:00 AM",\n    "reclat": "50.775000",\n    "reclong": "6.083330",\n    "GeoLocation": "(50.775000, 6.083330)"\n  },\n  {\n    "name": "Aarhus",\n    "id": "2",\n    "nametype": "Valid",\n    "recclass": "H6",\n    "mass": "720",\n    "fall": "Fell",\n    "year": "01/01/1951 12:00:00 AM",\n    "reclat": "56.183330",\n    "reclong": "10.233330",\n    "GeoLocation": "(56.183330, 10.233330)"\n  },\n  {\n    "name": "Abee",\n    "id": "6",\n    "nametype": "Valid",\n    "recclass": "EH4",\n    "mass": "107000",\n    "fall": "Fell",\n    "year": "01/01/1952 12:00:00 AM",\n    "reclat": "54.216670",\n    "reclong": "-113.000000",\n    "GeoLocation": "(54.216670, -113.000000)"\n  },\n  {\n    "name": "Acapulco",\n    "id": "10",\n    "nametype": "Valid",\n    "recclass": "Acapulcoite",\n    "mass": "1914",\n    "fall": "Fell",\n    "year": "01/01/1976 12:00:00 AM",\n    "reclat": "16.883330",\n    "reclong": "-99.900000",\n    "GeoLocation": "(16.883330, -99.900000)"\n  },\n  {\n    "name": "Achiras",\n    "id": "370",\n    "nametype": "Valid",\n    "recclass": "L6",\n    "mass": "780",\n    "fall": "Fell",\n    "year": "01/01/1902 12:00:00 AM",\n    "reclat": "-33.166670",\n    "reclong": "-64.950000",\n    "GeoLocation": "(-33.166670, -64.950000)"\n  }\n]'},{id:"continents-source",name:"Map of countries",type:"map",url:"http://localhost:9000/scripts/json/continent.json",dataType:"json",sample:'{\n  "type": "Topology",\n  "transform": {\n    "scale": [\n      0.03600360036003601,\n      0.017366249624962495\n    ],\n    "translate": [\n      -180,\n      -90\n    ]\n  },\n  "objects": {\n    "land": {\n      "type": "MultiPolygon",\n      "arcs": []\n    },\n    "countries": {\n      "type": "GeometryCollection",\n      "geometries": [\n        {\n          "type": "Polygon",\n          "id": 4,\n          "arcs": [],\n          "properties": {\n            "name": "Afghanistan",\n            "type": "country",\n            "capital": "Kabul",\n            "borders": "Surrounding Countries:  China, Iran, Pakistan, Tajikistan, Turkmenistan, Uzbekistan",\n            "continent": "Asia"\n          }\n        },\n        {\n          "type": "MultiPolygon",\n          "id": 24,\n          "arcs": [],\n          "properties": {\n            "name": "Angola",\n            "type": "country",\n            "capital": "Luanda",\n            "borders": "Surrounding Countries:  Democratic Republic of the Congo, Republic of the Congo, Namibia, Zambia",\n            "continent": "Africa"\n          }\n        },\n        {\n          "type": "Polygon",\n          "id": 8,\n          "arcs": [],\n          "properties": {\n            "name": "Albania",\n            "type": "country",\n            "capital": "Tirana",\n            "continent": "Europe"\n          }\n        },\n        {\n          "type": "Polygon",\n          "id": 784,\n          "arcs": [],\n          "properties": {\n            "name": "United Arab Emirates",\n            "type": "country",\n            "capital": "Abu Dhabi",\n            "continent": "Asia"\n          }\n        },\n        {\n          "type": "MultiPolygon",\n          "id": 32,\n          "arcs": [],\n          "properties": {\n            "name": "Argentina",\n            "type": "country",\n            "capital": "Buenos Aires",\n            "borders": "Surrounding Countries:  Bolivia, Brazil, Chile, Paraguay, Uruguay",\n            "continent": "South America"\n          }\n        }\n      ]\n    }\n  },\n  "arcs": []\n}'}]},getSourcesSample2:function(){return[{id:"us-counties",name:"US counties",type:"map",url:"http://localhost:9000/scripts/json/us-counties.json",dataType:"json",sample:'{\n  "type": "Topology",\n  "objects": {\n    "counties": {\n      "type": "GeometryCollection",\n      "bbox": [\n        -179.1473399999999,\n        17.67439566600018,\n        179.7784800000003,\n        71.38921046500008\n      ],\n      "geometries": [\n        {\n          "type": "MultiPolygon",\n          "id": 53073,\n          "arcs": []\n        },\n        {\n          "type": "Polygon",\n          "id": 30105,\n          "arcs": []\n        },\n        {\n          "type": "Polygon",\n          "id": 30029,\n          "arcs": []\n        },\n        {\n          "type": "Polygon",\n          "id": 16021,\n          "arcs": []\n        },\n        {\n          "type": "Polygon",\n          "id": 30071,\n          "arcs": []\n        }\n      ]\n    },\n    "states": {\n      "type": "GeometryCollection",\n      "geometries": [\n        {\n          "type": "MultiPolygon",\n          "arcs": [],\n          "id": 53\n        },\n        {\n          "type": "MultiPolygon",\n          "arcs": [],\n          "id": 30\n        },\n        {\n          "type": "MultiPolygon",\n          "arcs": [],\n          "id": 16\n        },\n        {\n          "type": "MultiPolygon",\n          "arcs": [],\n          "id": 38\n        },\n        {\n          "type": "MultiPolygon",\n          "arcs": [],\n          "id": 27\n        }\n      ]\n    },\n    "land": {\n      "type": "MultiPolygon",\n      "arcs": []\n    }\n  },\n  "arcs": [],\n  "transform": {\n    "scale": [\n      0.0003589261789261791,\n      0.0000537148685138684\n    ],\n    "translate": [\n      -179.1473399999999,\n      17.67439566600018\n    ]\n  }\n}'},{id:"us-unemployment",name:"US unemployment",type:"data",url:"http://localhost:9000/scripts/json/unemployment.tsv",dataType:"tsv",structure:'[\n  "id",\n  "rate"\n]',rowNumber:3218,minMax:'{\n  "id": [\n    "1001",\n    "72153"\n  ],\n  "rate": [\n    ".012",\n    ".301"\n  ]\n}',sample:'[\n  {\n    "id": "1001",\n    "rate": ".097"\n  },\n  {\n    "id": "1003",\n    "rate": ".091"\n  },\n  {\n    "id": "1005",\n    "rate": ".134"\n  },\n  {\n    "id": "1007",\n    "rate": ".121"\n  },\n  {\n    "id": "1009",\n    "rate": ".099"\n  }\n]'}]}}}),angular.module("mapManager.persistence",["app.config","mapManager.samples"]).service("providerService",["$localStorage",function(a){return{currentProvider:null,getCurrentProvider:function(){return this.currentProvider},hasCurrentProvider:function(){return null!=this.currentProvider},isInMemoryCurrentProvider:function(){return this.hasCurrentProvider()&&"inmemory"===this.currentProvider.type},isBrowserStorageCurrentProvider:function(){return this.hasCurrentProvider()&&"browserstorage"===this.currentProvider.type},isWebApiCurrentProvider:function(){return this.hasCurrentProvider()&&"webapi"===this.currentProvider.type},selectInMemoryProvider:function(){this.currentProvider={type:"inmemory"},a.currentProvider=this.currentProvider},selectBrowserStorageInMemoryProvider:function(){this.currentProvider={type:"browserstorage"},a.currentProvider=this.currentProvider},selectWebApiProvider:function(b){this.currentProvider={type:"webapi",url:b.url,username:b.username,password:b.password,readonly:b.readonly,secured:b.secured},a.currentProvider=this.currentProvider}}}]).factory("mapInMemoryResource",["$q","$timeout","$localStorage","$resource","storageType","addSamples","apiBaseUrl","uuid4","samplesService",function(a,b,c,d,e,f,g,h,i){return createInMemoryPersistenceService("map",a,b,h,i,f)}]).factory("mapBrowserStorageResource",["$q","$timeout","$localStorage","$resource","storageType","addSamples","apiBaseUrl","uuid4","samplesService",function(a,b,c,d,e,f,g,h,i){return createLocalStoragePersistenceService("map",a,b,c,h,i,f)}]).factory("mapWebApiResource",["$http","providerService","apiBaseUrl",function(a,b,c){return createWebApiPersistenceService("map",a,b,c)}]).factory("mapResource",["providerService","mapInMemoryResource","mapBrowserStorageResource","mapWebApiResource",function(a,b,c,d){return createPersistenceService("map",a,b,c,d)}]).factory("layerInMemoryResource",["$q","$timeout","$localStorage","$resource","storageType","addSamples","apiBaseUrl","uuid4","samplesService",function(a,b,c,d,e,f,g,h,i){return createInMemoryPersistenceService("layer",a,b,h,i,f)}]).factory("layerBrowserStorageResource",["$q","$timeout","$localStorage","$resource","storageType","addSamples","apiBaseUrl","uuid4","samplesService",function(a,b,c,d,e,f,g,h,i){return createLocalStoragePersistenceService("layer",a,b,c,h,i,f)}]).factory("layerWebApiResource",["$http","providerService","apiBaseUrl",function(a,b,c){return createWebApiPersistenceService("layer",a,b,c)}]).factory("layerResource",["providerService","layerInMemoryResource","layerBrowserStorageResource","layerWebApiResource",function(a,b,c,d){return createPersistenceService("layer",a,b,c,d)}]).factory("sourceInMemoryResource",["$q","$timeout","$localStorage","$resource","storageType","addSamples","apiBaseUrl","uuid4","samplesService",function(a,b,c,d,e,f,g,h,i){return createInMemoryPersistenceService("source",a,b,h,i,f)}]).factory("sourceBrowserStorageResource",["$q","$timeout","$localStorage","$resource","storageType","addSamples","apiBaseUrl","uuid4","samplesService",function(a,b,c,d,e,f,g,h,i){return createLocalStoragePersistenceService("source",a,b,c,h,i,f)}]).factory("sourceWebApiResource",["$http","providerService","apiBaseUrl",function(a,b,c){return createWebApiPersistenceService("source",a,b,c)}]).factory("sourceResource",["providerService","sourceInMemoryResource","sourceBrowserStorageResource","sourceWebApiResource",function(a,b,c,d){
return createPersistenceService("source",a,b,c,d)}]),angular.module("mapManager.d3.services",["mapManager.map","mapManager.console","d3"]).service("mapCreatorService",["currentMapService","mapInteractionService","layerService","projectionService","d3Service","mapHelper","valueChecker","svgHelper",function(a,b,c,d,e,f,g,h){return{refreshMap:function(b,c){_.isNull(a.getCurrentMapContext().svg)||a.getCurrentMapContext().svg.remove(),this.createMap(b,c)},createMap:function(e,i){var j=i.width(),k=i.height(),l=938,m=570,n=d.createProjection(a.getCurrentMap().projection,{width:l,height:m});_.isNull(n)||_.isNull(a.getCurrentMap().scale)||n.scale(a.getCurrentMap().scale),_.isNull(n)||"orthographic"!==a.getCurrentMap().projection||_.isNull(a.getCurrentMap().center)||n.rotate([a.getCurrentMap().center.lon,a.getCurrentMap().center.lat]),!_.isNull(n)&&"orthographic"===a.getCurrentMap().projection&&g.isNotNull(a.getCurrentMap().clipAngle)&&n.clipAngle(a.getCurrentMap().clipAngle);var o=d.configurePathWithProjection(n),p=h.createSvgElement(i,l,m,j,k),q=f.createMainMapStructure(p);a.registerCurrentMapContext(p,o,n,q.gMap,q.gLayers,{width:l,height:m,mWidth:j,mHeight:k});var r=a.getCurrentMap().layers;_.forEach(r,function(a){a.applied&&g.isNull(a.applyOn)&&c.createLayer(p,o,a,r)});var s=a.currentMap.interactions;_.isNull(s)||_.isNull(s.moving)||b.configureMoving(e,p,s.moving,{type:a.getCurrentMap().projection,raw:n},f.getMapElements()),_.isNull(s)||_.isNull(s.zooming)||b.configureZooming(e,p,s.zooming,{type:a.getCurrentMap().projection,raw:n},{width:"",height:""},f.getMapElements())},updateProjection:function(b,c){a.getCurrentMap().projection=c,this.refreshMap(b,a.getCurrentMapElement())},updateScale:function(b,c){a.getCurrentMap().scale=c,this.refreshMap(b,a.getCurrentMapElement())}}}]).service("projectionService",["d3Service",function(a){return{createMercatorProjection:function(b){var c=a.geo.mercator().translate([b.width/2,b.height/1.5]);return c},createOrthographicProjection:function(){var b=a.geo.orthographic().scale(248).clipAngle(90);return b},createSatelliteProjection:function(){var b=a.geo.satellite().distance(1.1).scale(5500).rotate([76,-34.5,32.12]).center([-2,5]).tilt(25).clipAngle(180*Math.acos(1/1.1)/Math.PI-1e-6).precision(.1);return b},createProjection:function(a,b){var c=null;return"orthographic"===a?c=this.createOrthographicProjection(b):"satellite"===a?c=this.createSatelliteProjection(b):"mercator"===a&&(c=this.createMercatorProjection(b)),c},configurePathWithProjection:function(b,c){return(_.isNull(c)||_.isUndefined(c))&&(c=a.geo.path()),_.isNull(b)?c:c.projection(b)}}}]).service("mapInteractionService",["consoleService","currentMapService","d3Service","d3Helper","valueChecker",function(a,b,c,d,e){return{configureMovingWithMouseDragForOrthographicProjection:function(e,f,g,h){var i,j,k=b.getCurrentMapId(),l=c.behavior.drag().on("dragstart",function(){var a=g.rotate();i=[c.event.sourceEvent.pageX,c.event.sourceEvent.pageY],j=[-a[0],-a[1]]}).on("drag",function(){if(i){var f=[c.event.sourceEvent.pageX,c.event.sourceEvent.pageY],l=[j[0]+(i[0]-f[0])/4,j[1]+(f[1]-i[1])/4];g.rotate([-l[0],-l[1]]),d.updateMapElements(k,g,h),e.$apply(function(){b.getCurrentMapContext().properties.center.lon=l[0],b.getCurrentMapContext().properties.center.lat=l[1]}),a.logMessage("debug","Rotated to "+JSON.stringify(l))}});c.select("#"+k).call(l)},configureMovingWithMouseMoveForOrthographicProjection:function(a,f,g,h){function i(){n=d.trackballAngles(g,c.mouse(f[0][0])),l=g.rotate(),c.event.preventDefault()}function j(){if(n){var a=d.trackballAngles(g,c.mouse(f[0][0]));m=d.composedRotation(l[0],l[1],l[2],a[0]-n[0],a[1]-n[1]),g.rotate(m),d.updateMapElements(o,g,h),e.isNotNull(b.getCurrentMapContext().properties)&&(b.getCurrentMapContext().properties.center.lon=m[0],b.getCurrentMapContext().properties.center.lat=m[1]);var i=f.node().getBBox();i.x,i.y,i.x+i.width,i.y+i.height}}function k(){n&&(j(),n=null)}var l,m,n=null,o=b.getCurrentMapId(),o=b.getCurrentMapId();c.select("#"+o).on("mousedown",i).on("mousemove",j).on("mouseup",k)},configureMovingForMercatorProjection:function(a,b,c,d){},configureMoving:function(b,c,d,e,f){"orthographic"===e.type?(a.logMessage("info","Configuring moving for projection orthographic"),"mouseMove"===d?(a.logMessage("info",'Selected moving "mouse move"'),this.configureMovingWithMouseMoveForOrthographicProjection(b,c,e.raw,f)):"mouseDrag"===d&&(a.logMessage("info",'Selected moving "mouse drag"'),this.configureMovingWithMouseDragForOrthographicProjection(b,c,e.raw,f))):"mercator"===e.type},configureZoomingWithMouseWheelForOrthographicProjection:function(f,g,h,i,j){var k=b.getCurrentMapId(),l=c.behavior.zoom().scale(h.scale()).on("zoom",function(){a.logMessage("debug","Updated scale to "+l.scale()),h.scale(c.event.scale),d.updateMapElements(k,h,j),e.isNotNull(b.getCurrentMapContext().properties)&&(b.getCurrentMapContext().properties.scale=l.scale())});c.select("#"+k).call(l)},configureZoomingWithMouseWheelForMercatorProjection:function(a,d){function e(){var a=d3.event.translate,b=d3.event.scale,c=i/4;a[0]=Math.min(h/i*(b-1),Math.max(h*(1-b),a[0])),a[1]=Math.min(c*(b-1)+c*b,Math.max(i*(1-b)-c*b,a[1])),k.translate(a),j.attr("transform","translate("+a+")scale("+b+")")}var f=b.getCurrentMapId(),g=b.getCurrentMapContext().dimensions,h=g.width,i=g.height,j=c.select("#"+f),k=d3.behavior.zoom().scaleExtent([1,9]).on("zoom",e);j.call(k)},configureDefaultZoomingWithMouseWheel:function(a,d){var e=b.getCurrentMapId(),f=c.behavior.zoom().translate([0,0]).scale(1).scaleExtent([1,8]).on("zoom",function(){var d=b.getCurrentMapContext();d.gMap.attr("transform","translate("+c.event.translate.join(",")+")scale("+c.event.scale+")"),a.$apply(function(){b.getCurrentMapContext().properties.scale=f.scale()})}),g=c.select("#"+e);g.call(f),g.call(f.event)},configureZooming:function(b,c,d,e,f,g){"orthographic"===e.type?(a.logMessage("info","Configuring zooming for projection orthographic"),"mouseWheel"===d&&(a.logMessage("info",'Selected zooming "mouse wheel"'),this.configureZoomingWithMouseWheelForOrthographicProjection(b,c,e.raw,f,g))):"mercator"===e.type?(a.logMessage("info","Configuring zooming for projection mercator"),"mouseWheel"===d&&(a.logMessage("info",'Selected zooming "mouse wheel"'),this.configureZoomingWithMouseWheelForMercatorProjection(b,c,e.raw,f,g))):this.configureDefaultZoomingWithMouseWheel(b,c)}}}]),angular.module("mapManager.d3.services").service("layerService",["currentMapService","mapInteractionService","consoleService","valueChecker","expressionService","d3Service","propertiesHelper","mapHelper","d3Helper","$interval",function(a,b,c,d,e,f,g,h,i,j){return{getLoadFunction:function(a){var b=null;return"json"===a||"topojson"===a?b=f.json:"csv"===a?b=f.csv:"tsv"===a&&(b=f.tsv),b},toggleLayerVisibility:function(b){var d=a.getCurrentMapId(),e=d3.select(document.getElementById(d+"-"+b.id)),f="visible"===e.style("visibility");f?(c.logMessage("info",'Hidden layer with id "'+b.id+'"'),e.style("visibility","hidden")):(c.logMessage("info",'Displayed layer with id "'+b.id+'"'),e.style("visibility","visible"))},toggleLayerApplying:function(a,b,c){c.applied?this.deleteLayer(a,b,c):this.createLayer(a,b,c)},refreshLayerApplying:function(a,b,c){c.applied&&(this.deleteLayer(a,b,c),this.createLayer(a,b,c))},getLayerElement:function(b,c){var e=(a.getCurrentMapContext(),a.getCurrentMapId()),g=f.select(document.getElementById(e+"-"+c.id));if(g.empty()){var h=c.applyOn;d.isNull(h)&&(h="layers");var i=f.select(document.getElementById(e+"-"+h));d.isNull(i)&&(i=b),g=i.append("g").attr("id",e+"-"+c.id)}return g},addPropertiesToData:function(a,b,c,f){var g=this,h=e.parseExpression(a.properties.url),i=g.getLoadFunction(a.properties.type);i(e.evaluateExpression(h,null,null,f),function(e){b=g.formatDataAsArray(a,b),_.forEach(b.objects[a.rootObject].geometries,function(a){var b=_.find(e,"id",a.id.toString());d.isNotNull(b)&&(a.properties=b)}),b.objects[a.rootObject].geometries=g.filterDataForLayer(a,b.objects[a.rootObject].geometries,f),c(b)})},loadDataForLayer:function(a,b,c){var f=this;if(a.loaded)c(this.filterDataForLayer(a.content,a.properties));else if(d.isNotNullAndNotEmpty(a.inline)){var g=e.parseExpression(a.inline);c(f.filterDataForLayer(a,g(),b))}else{var h=e.parseExpression(a.url),i=f.getLoadFunction(a.type);i(e.evaluateExpression(h,null,null,b),function(e){"topojson"===a.type&&d.isNotNull(a.properties)&&d.isNotNull(a.properties.url)?f.addPropertiesToData(a,e,c,b):(e=f.formatDataAsArray(a,e),c(f.filterDataForLayer(a,e,b)))})}},formatDataAsArray:function(a,b){if(_.isObject(b)&&a.formatDataAsArray){var c=[];return _.forEach(b,function(a,b){c.push(a)}),c}return b},filterDataForLayer:function(a,b,c){if(d.isNotNull(a.where)){var f=e.parseExpression(a.where);b=_.filter(b,function(a,b){return f(e.getExpressionContext(a,b,c))})}if(d.isNotNull(a.order)&&d.isNotNull(a.order.field)){var g=a.order.field,h=a.order?a.order:!0;b=b.sort(function(a,b){return h.ascending?a[g]-b[g]:b[g]-a[g]})}return b},createTooltipEvents:function(a,b,c,g,h,i,j){"click"===h?a.on("click",function(a,h){c.transition().duration(300).style("opacity",1),c.html(function(){if(d.isNotNull(a.d)){var c=e.getExpressionContext(a.d,h,j);return d.isNotNull(b)&&(c.value=b[a.d.id]),e.evaluateExpression(g,null,null,c)}var c=e.getExpressionContext(a,h,j);return d.isNotNull(b)&&(c.value=b[a.id]),e.evaluateExpression(g,null,null,c)}).style("left",f.event.pageX+"px").style("top",f.event.pageY-30+"px")}):"mouseover"===h&&a.on("mouseover",function(a,h){c.transition().duration(300).style("opacity",1),c.html(function(){if(d.isNotNull(a.d)){var c=e.getExpressionContext(a.d,h,j);return d.isNotNull(b)&&(c.value=b[a.d.id]),g(c)}var c=e.getExpressionContext(a,h,j);return d.isNotNull(b)&&(c.value=b[a.id]),g(c)}).style("left",f.event.pageX+"px").style("top",f.event.pageY-30+"px")}),"mouseout"===i&&a.on("mouseout",function(){c.transition().duration(300).style("opacity",0)})},createGraticuleLayer:function(a,b,d,e,g){c.logMessage("info",'Creating graticule layer with identifier "'+d.id+'"'),null===d.id&&(d.id="graticuleLayer");var h=this.getLayerElement(a,d),i=f.geo.graticule();if(d.display.background&&d.display.border){if(h.append("defs").append("path").datum({type:"Sphere"}).attr("id","sphere").attr("d",b),d.display.border){var j="#000",k="1px";null!=d.styles.border&&(null!=d.styles.border.stroke&&(j=d.styles.border.stroke),null!=d.styles.border.strokeWidth&&(k=d.styles.border.strokeWidth)),h.append("use").style("stroke",j).style("stroke-width",k).style("fill","none").attr("xlink:href","#sphere")}if(d.display.background){var l="#000";null!=d.styles.background&&null!=d.styles.background.fill&&(l=d.styles.background.fill),h.append("use").style("fill",l).attr("xlink:href","#sphere")}}if(d.display.lines){var m="#777",n="0.5px",o="0.5";null!=d.styles.lines&&(null!=d.styles.lines.stroke&&(m=d.styles.lines.stroke),null!=d.styles.lines.strokeWidth&&(n=d.styles.lines.strokeWidth),null!=d.styles.lines.strokeOpacity&&(o=d.styles.lines.strokeOpacity)),h.append("path").attr("id",d.id).datum(i).style("fill","none").style("stroke",m).style("stroke-width",n).style("stroke-opacity",o).attr("d",b)}},applyStylesForGeoDataLayer:function(a,b,c){if(d.isNotNull(a.styles)){if(d.isNotNull(a.styles.background)){var g="#fff";d.isNotNull(a.styles.background.fill)&&(g=a.styles.background.fill),b.style("fill",g)}if(d.isNotNull(a.styles.lines)){var h="#fff",i="0.5px",j="0.5";d.isNotNull(a.styles.lines.stroke)&&(h=a.styles.lines.stroke),d.isNotNull(a.styles.lines.strokeWidth)&&(i=a.styles.lines.strokeWidth),d.isNotNull(a.styles.lines.strokeOpacity)&&(j=a.styles.lines.strokeOpacity),b.style("stroke",h),b.style("stroke-width",i),b.style("stroke-opacity",j)}}if(d.isNotNull(a.display)&&d.isNotNull(a.display.fill))if(d.isNotNull(a.display.fill.categorical)&&d.isNotNull(a.display.fill.categorical.value)&&d.isNotNull(a.display.fill.categorical.name)){var k=e.parseExpression(a.display.fill.categorical.value),l=f.scale.category20(),m=20;d.isNotNull(a.display.fill.categorical.name)&&("category10"===a.display.fill.categorical.name?(l=f.scale.category10(),m=10):"category20"===a.display.fill.categorical.name?(l=f.scale.category20(),m=20):"category20b"===a.display.fill.categorical.name?(l=f.scale.category20b(),m=20):"category20c"===a.display.fill.categorical.name&&(l=f.scale.category20c(),m=20)),b.style("fill",function(a,b){return l(e.evaluateExpression(k,a,b,c)%m)})}else if(d.isNotNull(a.display.fill.value)){var k=e.parseExpression(a.display.fill.value);b.style("fill",function(a,b){return e.evaluateExpression(k,a,b,c)})}},configureBehaviors:function(a,b,c,e,f){var h=g.getDomainEvents(c,"zoomBoundingBox"),i=g.getDomainEvents(c,"subMap");d.isNotNull(c.behavior)&&d.isNotNull(c.behavior.zoomBoundingBox)?this.configureZoomBoundingBehavior(a,b,c,f,h):d.isNotNull(c.display)&&d.isNotNull(c.display.subMap)&&d.isNotNull(i)&&this.configureSubMapBehavior(a,b,c,e,f,i)},configureZoomBoundingBehavior:function(b,c,e,g){g.on("click",function(b){var c=a.getCurrentMapContext(),e=c.projection;d.isNotNull(e)&&f.transition().delay(100).duration(750).tween("rotate",function(){var a=f.geo.centroid(b),c=f.interpolate(e.rotate(),[-a[0],-a[1]]);return function(a){e.rotate(c(a))}})})},getBounds:function(a,b,c,d){var e=d3.geo.bounds(b),f=e[1][0]-e[0][0],g=e[1][1]-e[0][1],h=(e[0][0]+e[1][0])/2,i=(e[0][1]+e[1][1])/2,j=.9/Math.max(f/c,g/d),k=[c/2-j*h,d/2-j*i];return{bounds:e,translate:k,scale:j}},applyLayersOnSubMap:function(a,b,c,d,e,f){var g=this;_.forEach(c.display.subMap.layers,function(c){var e=_.find(d,"id",c);g.createLayer(a,b,e,d,f)}),g.configureSubMapLegend(a,b,c,e,f)},unapplyLayersOnSubMap:function(a,b){_.forEach(b.display.subMap.layers,function(a){f.select("#map2-"+a).remove()})},executeShowSubMapTransition:function(b,c,d,e,g){f.select("#map2-layers").transition().delay(100).duration(750).tween("rotate",function(){var a=f.geo.centroid(b),g=f.interpolate(c.rotate(),[-a[0],-a[1]]);return function(a){c.rotate(g(a)),d=d.projection(c),e.attr("d",d)}}).tween("scale",function(){var g=d.bounds(b),h=g[1][0]-g[0][0],i=g[1][1]-g[0][1],j=a.getCurrentMapContext().dimensions,k=j.width,l=j.height,m=.8/Math.max(h/k,i/l),n=f.interpolate(c.scale(),m*c.scale());return function(a){c.scale(n(a)),d=d.projection(c),e.attr("d",d)}}).each("end",g)},createHideSubMapTransition:function(b,c,d,e,g,h){var i=this;return function(){var j=e;a.setCurrentMapId("map1"),i.unapplyLayersOnSubMap(b,c),f.select("#map2-layers").transition().delay(100).duration(750).tween("rotate",function(){var b=f.interpolate(d.rotate(),[a.getCurrentMapContext().properties.center.lon,a.getCurrentMapContext().properties.center.lat]);return function(a){d.rotate(b(a)),g=g.projection(d),h.attr("d",g)}}).tween("scale",function(){var b=f.interpolate(d.scale(),a.getCurrentMapContext().properties.scale);return function(a){d.scale(b(a)),g=g.projection(d),h.attr("d",g)}}).each("end",function(){j.remove()}),f.select("#map1").transition().delay(100).duration(750).attr("transform","translate(0,0)scale(1,1)")}},configureSubMapBehavior:function(c,d,e,g,i,j){var k=this;"click"===j.display&&i.on("click",function(d){var i=a.getCurrentMapContext(),j=i.dimensions.width,l=i.dimensions.height,m="mouseMove",n=h.createSubMapStructure(c,2,{width:j,height:l},{fill:"white",opacity:"0.75"}),o=n.gLayers.append("g").attr("id","root"),p=f.geo.orthographic().scale(a.getCurrentMapContext().properties.scale).clipAngle(90).rotate([a.getCurrentMapContext().properties.center.lon,a.getCurrentMapContext().properties.center.lat]),q=f.geo.path().projection(p);a.setCurrentMapId("map2"),a.registerCurrentMapContext(c,q,p,n.gMap,n.gLayers,{width:j,height:l}),b.configureMoving(null,c,m,{type:a.getCurrentMap().projection,raw:p},h.getMapElements());var r=o.selectAll("path").data([d]).enter().append("path").attr("id",function(a){return"cloned"+a.id}).attr("d",q).style("fill","grey").style("stroke","#fff").style("strokeWidth","1px").style("strokeOpacity","1"),s=k.getBounds(q,d,j,l);k.executeShowSubMapTransition(d,p,q,r,function(){k.applyLayersOnSubMap(c,q,e,g,o,{shape:d,bounds:s.bounds}),k.configureSubMapLegend(c,q,e,n.gMap,{shape:d,bounds:s.bounds},k.createHideSubMapTransition(c,e,p,n.gMap,q,r))}),f.select("#map1").transition().delay(100).duration(750).attr("transform","translate(750,40)scale(0.2083333283662796,0.2083333283662796)")})},configureSubMapLegend:function(a,b,c,f,g,h){if(d.isNotNull(c.display.subMap.legend)){var i=e.parseExpression(c.display.subMap.legend.label),j=f.append("g").attr("class","legend");j.append("rect").attr("x",10).attr("y",10).attr("width",150).attr("height",60).style("fill","grey").style("opacity","0.7"),j.append("text").attr("x",75).attr("y",35).text(function(){return e.evaluateExpression(i,null,null,g)}).style("text-anchor","middle"),j.append("text").attr("x",75).attr("y",55).text("close").style("text-anchor","middle").on("click",h);var k=f.append("g").attr("class","legend");k.append("rect").attr("x",10).attr("y",75).attr("width",150).attr("height",60).style("fill","grey").style("opacity","0.7"),k.append("text").attr("x",75).attr("y",100).attr("id","map2-animation").style("text-anchor","middle")}},configureShapeBounds:function(a,b,c,d){function e(a,b,c){b>c&&(c+=360);var d=c-b,e=d/Math.ceil(d);return d3.range(b,c+.5*e,e).map(function(b){return[g(b),a]})}function g(a){return(a+180)%360-180}b.selectAll("path").append("path").datum(function(a){var b=f.geo.bounds(a);return{type:"Polygon",coordinates:[[b[0]].concat(e(b[1][1],b[0][0],b[1][0])).concat(e(b[0][1],b[0][0],b[1][0]).reverse())]}}).attr("class","point").attr("d",function(a){return c(a)}).style({fill:"#94BF8B","fill-opacity":.25}).style({stroke:"#94BF8B","stroke-width":1,"stroke-linejoin":"round"})},applyDependentLayersOnLayer:function(a,b,c,e,f,g){var h=this,i=_.filter(e,function(a){return d.isNotNull(a.applyOn)&&a.applyOn===c.id});_.forEach(i,function(c){h.createLayer(a,b,c,e,g)})},createGeoDataLayer:function(a,b,c,d,e){function f(f){var i=null;if(c.data.mesh)i=h.append("path").datum(topojson.mesh(f,f.objects[c.data.rootObject],function(a,b){return a.id!==b.id})),g.applyStylesForGeoDataLayer(c,i,e),i.attr("d",b);else{var j=topojson.feature(f,f.objects[c.data.rootObject]).features;i=h.selectAll("path").data(j).enter().append("path").attr("id",function(a){return a.id}).attr("d",b),g.applyStylesForGeoDataLayer(c,i,e),g.configureTooltip(c,i,e)}g.configureBehaviors(a,b,c,d,i),g.applyDependentLayersOnLayer(a,b,c,d,h,e)}var g=this,h=this.getLayerElement(a,c);this.loadDataForLayer(c.data,e,f)},clearFillDataLayer:function(b,c){var d=a.getCurrentMapId(),e=f.select("#"+d+"-"+c.applyOn);e.selectAll("path").style("fill",function(a){return"#000"});var g=f.select("#"+d+"-layers");g.selectAll("g.legend").remove(),f.select(document.getElementById("tooltip-"+c.id)).remove()},applyStylesForFillLayer:function(a,b,c){var e={};if(d.isNotNull(a.display.fill.threshold)){var g=f.scale.threshold().domain(a.display.fill.threshold.values).range(a.display.fill.threshold.colors);e.color=g;var h=b.selectAll("path").style("fill",function(a){return g(c[a.id])});e.elements=h}else if(d.isNotNull(a.display.fill.choropleth)){var i=f.scale.quantize().domain(a.display.fill.choropleth.values).range(a.display.fill.choropleth.colors);e.color=i;var j=b.selectAll("path").style("fill",function(a){return i(c[a.id])});e.elements=j}return e},createFillDataLayer:function(b,c,d,g){function h(b){var d={};_.forEach(b,function(a,b){d[a.id]=+e.evaluateExpression(j,a,b,g)});var h=a.getCurrentMapId(),k=f.select("#"+h+"-"+c.applyOn),l=i.applyStylesForFillLayer(c,k,d);i.configureTooltip(c,l.elements,d,g),i.configureLegend(c,k,l,g)}var i=this,j=e.parseExpression(c.display.fill.value);this.loadDataForLayer(c.data,g,h)},applyStylesForShapeLayer:function(a,b,c){var g={};if(d.isNotNull(a.styles)&&d.isNotNull(a.styles.lines)&&(d.isNotNull(a.styles.lines.stroke)&&b.style("stroke",a.styles.lines.stroke),d.isNotNull(a.styles.lines.strokeWidth)&&b.style("stroke-width",a.styles.lines.strokeWidth)),d.isNotNull(a.display)&&d.isNotNull(a.display.shape))if(d.isNotNull(a.display.shape.opacity)&&b.style("opacity",a.display.shape.opacity),d.isNotNull(a.display.shape.color))b.style("fill",a.display.shape.color);else if(d.isNotNull(a.display.shape.threshold)){var h=f.scale.threshold().domain(a.display.shape.threshold.values).range(a.display.shape.threshold.colors);g.color=h;var i=e.parseExpression(a.display.shape.value);b.style("fill",function(a,b){var d=e.evaluateExpression(i,a.d,b,c);return h(parseFloat(d))})}else if(d.isNotNull(a.display.shape.choropleth)){var j=f.scale.choropleth().domain(a.display.shape.choropleth.values).range(a.display.shape.choropleth.colors);g.color=j;var k=e.parseExpression(a.display.shape.value);b.style("fill",function(a,b){var d=e.evaluateExpression(k,a.d,b,c);return j(parseFloat(d))})}return g},configureLegend:function(a,b,c,f){if(d.isNotNull(a.display)&&d.isNotNull(a.display.legend)&&a.display.legend.enabled){var g=e.parseExpression(a.display.legend.label);b.append("rect").attr("x",10).attr("y",350).attr("width",100).attr("height",150).style("fill","#fff").style("opacity","0.7");var h=500,i=null;d.isNotNull(a.display)&&(d.isNotNull(a.display.shape)?d.isNotNull(a.display.shape.threshold)&&d.isNotNull(a.display.shape.threshold.values)?i=a.display.shape.threshold.values:d.isNotNull(a.display.shape.choropleth)&&d.isNotNull(a.display.shape.choropleth.values)&&(i=a.display.shape.choropleth.values):d.isNotNull(a.display.fill)&&(d.isNotNull(a.display.fill.threshold)&&d.isNotNull(a.display.fill.threshold.values)?i=a.display.fill.threshold.values:d.isNotNull(a.display.fill.choropleth)&&d.isNotNull(a.display.fill.choropleth.values)&&(i=a.display.fill.choropleth.values))),d.isNull(i)&&(i=[]);var j=b.selectAll("g.legend").data(i).enter().append("g").attr("class","legend"),k=20,l=20;j.append("rect").attr("x",20).attr("y",function(a,b){return h-b*l-2*l}).attr("width",k).attr("height",l).style("fill",function(a){return c.color(a)}).style("opacity",.8),j.append("text").attr("x",50).attr("y",function(a,b){return h-b*l-l-4}).text(function(a,b){return e.evaluateExpression(g,a,b,f)})}},configureTooltip:function(a,b,c,h){if(g.hasPropertyConfigured(a,"display","tooltip")&&a.display.tooltip.enabled){var i=e.parseExpression(a.display.tooltip.text),j=f.select("body").append("div").attr("id","tooltip-"+a.id).attr("class","tooltip").style("opacity",0),k=g.getDomainEvents(a,"tooltip");d.isNotNull(k)&&this.createTooltipEvents(b,c,j,i,k.display,k.hide,h)}},configureShapeLabel:function(b,c,f,g,h){if(d.isNotNull(b.display.shape.label)){var i=a.getCurrentMapContext().projection,j=e.parseExpression(b.display.shape.label.text),k=0,l=0;d.isNotNull(b.display.shape.label.position)&&(d.isNotNull(b.display.shape.label.position.x)&&(k=b.display.shape.label.position.x),d.isNotNull(b.display.shape.label.position.y)&&(l=b.display.shape.label.position.y)),c.selectAll("text").data(f).enter().append("text").attr("x",function(a,b){var c=e.evaluateExpression(g,a,b,h);return i(c)[0]}).attr("dx",k).attr("y",function(a,b){var c=e.evaluateExpression(g,a,b,h);return i(c)[1]}).attr("dy",l).text(function(a,b){return e.evaluateExpression(j,a,b,h)}).style("fill","gray").style("font-size","10px")}},createCircleObjectsDataLayer:function(a,b,h,i,k){function l(a,b,c,f){return _.filter(a,function(a,g){var h=e.evaluateExpression(b,a,g,c);return d.isNotNaN(h)?d.isNotNull(f)?h>f:!0:!1})}function m(a,b,c){var d=_.min(a,function(a,d){return e.evaluateExpression(b,a,d,c)}),f=_.max(a,function(a,d){return e.evaluateExpression(b,a,d,c)});return{min:e.evaluateExpression(b,d,0,c),max:e.evaluateExpression(b,f,0,c)}}function n(a){var c=h.data.id?h.data.id:"id",i={};if(_.forEach(a,function(a){i[a[c]]=a}),g.hasPropertyConfigured(h,"behavior","animation")){var n=e.parseExpression(h.behavior.animation.value),t=null;d.isNotNull(h.behavior.animation.startValue)&&(t=h.behavior.animation.startValue);var u=l(a,n,k,t),v=s.selectAll("circle").data(u).enter().append("path");v.datum(function(a,b){var c=e.evaluateExpression(p,a,b,k);c[0]=parseFloat(c[0]),c[1]=parseFloat(c[1]);var d=e.evaluateExpression(q,a,b,k);d=parseFloat(d);var f=r.origin(c).angle(d)(e.getExpressionContext(a,b,k));return f.d=a,f}).attr("id",function(a){return a.d.name}).attr("class","point").attr("d",function(a){return b(a)}).style("fill-opacity",0);var w=o.applyStylesForShapeLayer(h,v,k);o.configureTooltip(h,v,i,k),o.configureLegend(h,s,w,k);var x=u.length,y=m(u,n,k),z=y.min,A=500;d.isNotNull(h.behavior.animation.interval)&&(A=h.behavior.animation.interval);var B=null;d.isNotNull(h.behavior.animation.label)&&(B=e.parseExpression(h.behavior.animation.label));var C=j(function(){d.isNotNull(B)?f.select("#map2-animation").text(B(e.getExpressionContext(z,0,k))):f.select("#map2-animation").text(z),z++,z>y.max&&(f.select("#map2-animation").text(""),j.cancel(C))},A),D=!1;d.isNotNull(h.behavior.animation.showAllAtEnd)&&(D=h.behavior.animation.showAllAtEnd),v.transition().delay(function(a,b){return(e.evaluateExpression(n,a.d,b,k)-y.min)*A}).duration(function(){return A}).each("start",function(){f.select(this).style("fill-opacity",1)}).each("end",function(){f.select(this).style("fill-opacity",0),x--,0===x&&D&&v.style("fill-opacity",1)})}else{var v=s.selectAll("circle").data(a).enter().append("path");v.datum(function(a,b){var c=e.evaluateExpression(p,a,b,k);c[0]=parseFloat(c[0]),c[1]=parseFloat(c[1]);var d=e.evaluateExpression(q,a,b,k);d=parseFloat(d);var f=r.origin(c).angle(d)(e.getExpressionContext(a,b,k));return f.d=a,f}).attr("id",function(a){return a.d.name}).attr("class","point").attr("d",function(a){return b(a)}),o.configureShapeLabel(h,s,a,p,k);var w=o.applyStylesForShapeLayer(h,v,k);o.configureTooltip(h,v,i,k),o.configureLegend(h,s,w,k)}}var o=this,p=e.parseExpression(h.display.shape.origin),q=e.parseExpression(h.display.shape.radius);c.logMessage("info",'Creating data layer with identifier "'+h.id+'"');var r=f.geo.circle(),s=this.getLayerElement(a,h);this.loadDataForLayer(h.data,k,n)},createImageObjectsDataLayer:function(a,b,d,g,h){function i(a){l.selectAll("circle").data(a).enter().append("path").datum(function(a,b){return k.origin(e.evaluateExpression(j,a,b,h))}).attr("class","point").attr("d",b).append("image").attr("xlink:href",function(a){return console.log("xlink:href"),"http://localhost:9000/scripts/json/icon_51440.svg"}).attr("height",function(a){return"19"}).attr("width","29")}var j=e.parseExpression(d.display.shape.origin);c.logMessage("info",'Creating data layer with identifier "'+d.id+'"');var k=f.geo.circle(),l=this.getLayerElement(a,d);this.loadDataForLayer(d.data,h,i)},createLineObjectsDataLayer:function(a,b,c,d,f){function g(a){_.isArray(a)?h.selectAll("path").data(a).enter().append("path").datum(function(a,b){var c=e.evaluateExpression(i,a,b,f),d=[];return _.forEach(c,function(a,b){d.push(e.evaluateExpression(j,a,b,f))}),{type:"LineString",coordinates:d,d:a}}).attr("d",b).style("fill","none").style("stroke",c.styles.lines.stroke).style("stroke-width",c.styles.lines.strokeWidth):h.selectAll("path").data(a).enter().append("path").datum(function(a,b){var c=e.evaluateExpression(i,a,b,f),d=[];return _.forEach(c,function(a,b){d.push(e.evaluateExpression(j,a,b,f))}),{type:"LineString",coordinates:d,d:a}}).attr("d",b).style("fill","none").style("stroke",c.styles.lines.stroke).style("stroke-width",c.styles.lines.strokeWidth)}var h=this.getLayerElement(a,c),i=e.parseExpression(c.display.shape.value),j=e.parseExpression(c.display.shape.pointValue);this.loadDataForLayer(c.data,f,g)},createPolygonObjectsDataLayer:function(a,b,c,d,f){function g(a){h.selectAll("path").data(a).enter().append("path").datum(function(a){var b=i({d:a}),c=[];return _.forEach(b,function(a,b){c.push(e.evaluateExpression(j,a,b,f))}),c.length>2&&c[0][0]!==c[1][0]&&c[0][1]!==c[1][1]&&c.push([c[0][0],c[0][1]]),{type:"LineString",coordinates:c,d:a}}).attr("d",b).style("fill",c.styles.background.fill).style("stroke",c.styles.lines.stroke).style("stroke-width",c.styles.lines.strokeWidth)}var h=this.getLayerElement(a,c),i=e.parseExpression(c.display.shape.value),j=e.parseExpression(c.display.shape.pointValue);this.loadDataForLayer(c.data,f,g)},createObjectsDataLayer:function(a,b,c,d,e){c.display.shape&&("circle"===c.display.shape.type?this.createCircleObjectsDataLayer(a,b,c,d,e):"image"===c.display.shape.type?this.createImageObjectsDataLayer(a,b,c,d,e):"line"===c.display.shape.type?this.createLineObjectsDataLayer(a,b,c,d,e):"polygon"===c.display.shape.type&&this.createPolygonObjectsDataLayer(a,b,c,d,e))},createLayer:function(a,b,d,e,f){c.logMessage("info",'Creating layer of type "'+d.type+'" with identifier "'+d.id+'"'),"graticule"===d.type?this.createGraticuleLayer(a,b,d,e,f):"data"===d.type&&"objects"===d.mode?this.createObjectsDataLayer(a,b,d,e,f):"data"===d.type&&"fill"===d.mode?this.createFillDataLayer(a,d,e,f):"geodata"===d.type&&this.createGeoDataLayer(a,b,d,e,f)},isLayerWithFillMode:function(a){return"data"===a.type&&"fill"===a.mode},deleteLayer:function(b,d,e){c.logMessage("info",'Deleting layer of type "'+e.type+'" with identifier "'+e.id+'"');var g=a.getCurrentMapId(),h=f.select("#"+g+"-"+e.id);this.isLayerWithFillMode(e)?this.clearFillDataLayer(b,e):h.selectAll("*").remove();var i=f.select("#map1-layers");i.selectAll("g.legend").remove(),f.select(document.getElementById("tooltip-"+e.id)).remove()},sortLayers:function(a){var b=f.select(document.getElementById("layers"));b.selectAll("g").sort(function(b,c){var d=_.find(a,{id:b.attr("id")}),e=_.find(a,{id:c.attr("id")});return d.rank-e.rank})}}}]),angular.module("mapManager.topojson.services",[]).service("topojsonService",function(){return{transformTopojson:function(a){var b=this;_.isArray(a)?_.forEach(a,function(a){b.transformTopojson(a)}):_.isObject(a)&&_.forIn(a,function(c,d){"arcs"===d?a[d]=[]:b.transformTopojson(a[d])})}}}),angular.module("mapManager.colorbrewer",[]).service("colorBrewer",function(){return{YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],
7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}}}),angular.module("mapManager.commons",["mapManager.map","mapManager.d3.services","mapManager.utilities"]).service("commonsService",["currentMapService","layerService","mapCreatorService","toaster","valueChecker",function(a,b,c,d,e){return{registerCommonFunctionsInScope:function(a,b,c,e,f){a.shoudDisplayHome=function(){return"home"===c},a.shoudDisplayMap=function(){return"map"===c},a.screenType=c,a.openAddMapDialog=function(){var c=b.open({animation:!1,templateUrl:"views/modals/add-map-modal.html",controller:"AddMapCtrl"});c.result.then(function(b){a.maps.push(b),d.pop("success",'Map "'+sourceToAdd.name+'"',"Successfully added")},function(){})},a.openAddSourceDialog=function(){var c=b.open({animation:!1,templateUrl:"views/modals/add-source-modal.html",controller:"AddSourceCtrl"});c.result.then(function(b){a.sources.push(b),d.pop("success",'Source "'+b.name+'"',"Successfully added")},function(){})},a.maps=e,a.sources=f},setCurrentMapInScope:function(b,c){b.properties={projection:c.projection,scale:c.scale,center:c.center},b.interactions={moving:c.interactions.moving,zooming:c.interactions.zooming},b.mapName=c.name,b.mapType=c.type,b.layers=c.layers,b.linkedSources=c.sources,b.currentProperties=a.getCurrentMapContext().properties,b.$watch("currentProperties.scale",function(a,b){})},registerCommonMapFunctionsInScope:function(d){d.shouldDisplayGraticuleProperties=function(a){return"graticule"===a.type},d.shouldDisplayGeoDataProperties=function(a){return"geodata"===a.type},d.shouldDisplayGeoDataStylesProperties=function(a){return"geodata"===a.type&&null!=a.styles},d.shouldDisplayDataFillProperties=function(a){return"data"===a.type&&"fill"===a.mode},d.shouldDisplayDataObjectsProperties=function(a){return"data"===a.type&&"objects"===a.mode},d.shouldDisplayDataCircleProperties=function(a){return"data"===a.type&&"objects"===a.mode&&"circle"===a.display.shape.type},d.shouldDisplayDataPolygonProperties=function(a){return"data"===a.type&&"objects"===a.mode&&"polygon"===a.display.shape.type},d.shouldDisplayDataSquareProperties=function(a){return"data"===a.type&&"objects"===a.mode&&"square"===a.display.shape.type},d.shouldDisplayDataLineProperties=function(a){return"data"===a.type&&"objects"===a.mode&&"line"===a.display.shape.type},d.shouldDisplayElementArea=function(a,b,c){return e.isNotNull(a[b])&&e.isNotNull(a[b][c])},d.addElementArea=function(a,b,c){e.isNotNull(a[b])&&(a[b][c]={})},d.removeElementArea=function(a,b,c){e.isNotNull(a[b])&&e.isNotNull(a[b][c])&&delete a[b][c]},d.shouldDisplayShapeArea=function(a){return e.isNotNull(a.display)&&e.isNotNull(a.display.shape)},d.addDisplayShapeArea=function(a){e.isNotNull(a.display)&&(a.display.shape={})},d.removeDisplayShapeArea=function(a){e.isNotNull(a.display)&&e.isNotNull(a.display.shape)&&delete a.display.shape},d.shouldDisplayLegendArea=function(a){return e.isNotNull(a.display)&&e.isNotNull(a.display.legend)},d.addDisplayLegendArea=function(a){e.isNotNull(a.display)&&(a.display.legend={})},d.removeDisplayLegendArea=function(a){e.isNotNull(a.display)&&e.isNotNull(a.display.legend)&&delete a.display.legend},d.shouldDisplayTooltipArea=function(a){return e.isNotNull(a.display)&&e.isNotNull(a.display.tooltip)},d.addDisplayTooltipArea=function(a){e.isNotNull(a.display)&&(a.display.tooltip={})},d.removeDisplayTooltipArea=function(a){e.isNotNull(a.display)&&e.isNotNull(a.display.tooltip)&&delete a.display.tooltip},d.isArray=function(a){return angular.isArray(a)},d.$watch("properties.projection",function(a,b){b!==a&&c.updateProjection(d,a)}),d.$watch("properties.scale",function(a,b){b!==a&&c.updateScale(d,a)}),d.toggleLayerVisibility=function(a,c){b.toggleLayerVisibility(c),c.visible=!c.visible},d.toggleLayerApplying=function(c,d){var e=a.getCurrentMapContext().svg,f=a.getCurrentMapContext().path;b.toggleLayerApplying(e,f,d),d.applied=!d.applied},d.refreshLayerApplying=function(c,d){var e=a.getCurrentMapContext().svg,f=a.getCurrentMapContext().path;b.refreshLayerApplying(e,f,d)},d.isLayerWithFillMode=function(a){return"data"===a.type&&"fill"===a.mode}},registerCommonMapLayerFunctionsInScope:function(c,d){c.$watch("layer.styles.background.fill",function(d,e){if(e!==d){var f=c.layer,g=a.getCurrentMapContext().svg,h=a.getCurrentMapContext().path;b.refreshLayerApplying(g,h,f)}}),c.shoudDisplayCheckExpression=function(a){return e.isNotNull(a)},c.checkExpression=function(a,b,c,e,f,g,h){var i=d.open({animation:!1,templateUrl:"views/modals/expression-check-modal.html",controller:"CheckExpressionCtrl",resolve:{sourceId:function(){return e},expression:function(){return g},description:function(){return h},linkedSources:function(){return c},domain:function(){return a},attribute:function(){return b},rootObject:function(){return f}}});i.result.then(function(c){a[b]=c},function(){})}},registerCommonPanelFunctionsInScope:function(a,b){null==b&&(b="properties"),a.displayPanel=function(b){a.displayedPanel=b},a.shouldDisplayPanel=function(b){return a.displayedPanel===b},a.isDisplayedPanel=function(b){return a.displayedPanel===b},a.displayPanel(b)},registerCommonMapLayerPanelFunctionsInScope:function(a){a.shoudDisplayLayerMode=function(){return a.displayedLayerMode},a.toggleLayerMode=function(){a.displayedLayerMode=!a.displayedLayerMode},a.displayLayerMode=function(){a.displayedLayerMode=!0},a.hideLayerMode=function(){a.displayedLayerMode=!1},a.displayedLayerMode=!1},registerCommonMapSourcePanelFunctionsInScope:function(a){}}}]).service("expressionService",["valueChecker","$parse",function(a,b){return{getExpressionParameterDescriptions:function(){return"d: the current element in the collection\ni: the index of the current element in the collection\nparseDate: utility function to convert a string to a date object\nisInBounds: utility function to check if a point is in bounds"},getExpressionContext:function(b,c,d){var e={d:b,i:c,parseDate:function(a){return new Date(a)},isInBounds:function(a,b){var c=b[0],d=b[1];return a[0]>=c[0]&&a[0]<=d[0]&&a[1]>=c[1]&&a[1]<=d[1]},formatNumber:function(a,b){var c=Math.pow(10,b);return(Math.round(a*c)/c).toFixed(b)}};return a.isNotNull(d)&&_.forEach(d,function(a,b){e[b]=d[b]}),e},parseExpression:function(a){return b(a)},evaluateExpression:function(a,b,c,d){var e=a(this.getExpressionContext(b,c,d));return _.isFunction(e)?e():e}}}]),angular.module("mapManager.d3.directives",["mapManager.map","mapManager.d3.services","mapManager.console"]).directive("map",["currentMapService","mapInteractionService","mapCreatorService","d3Service",function(a,b,c,d){return{restrict:"A",scope:{val:"=",grouped:"="},link:function(b,e){d.select("#map1").remove(),a.setCurrentMapElement(e),a.setCurrentMapId("map1"),c.createMap(b,e)}}}]),angular.module("mapManager.form",[]).directive("field",function(){return{require:"^form",restrict:"EA",replace:!0,templateUrl:"views/directives/form-field-template.html",transclude:!0,scope:{label:"@",size:"@",classOpt:"@"},link:function(a,b){var c=b.find(":input").attr("name");c||(c=b.find("textarea").attr("name")),c||(c=b.find("select").attr("name")),a["for"]=c}}}).directive("fieldMultiLabels",function(){return{require:"^form",restrict:"EA",replace:!0,templateUrl:"views/directives/form-field-multi-labels-template.html",transclude:!0,scope:{label1:"@",label2:"@",size:"@",classOpt:"@"},link:function(a,b){var c=b.find(":input").attr("name");c||(c=b.find("textarea").attr("name")),c||(c=b.find("select").attr("name")),a["for"]=c}}}),angular.module("mapManagerApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","toaster","colorpicker.module","colorBrewer","d3","uuid4","ngStorage","app.config","mapManager.errors","mapManager.form","mapManager.console","mapManager.map","mapManager.source","mapManager.samples","mapManager.persistence","mapManager.commons","mapManager.utilities","mapManager.d3.services","mapManager.topojson.services","mapManager.d3.directives","mapManager.colorbrewer"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/global-layout.html",controller:"HomeCtrl",resolve:{maps:["mapsService",function(a){return a.resolveMaps()}],sources:["sourcesService",function(a){return a.resolveSources()}]}}).when("/maps/:mapId",{templateUrl:"views/global-layout.html",controller:"MapCtrl",resolve:{map:["mapsService",function(a){return a.resolveCurrentMap()}],mapLayers:["mapsService",function(a){return a.resolveCurrentMapLayers()}],maps:["mapsService",function(a){return a.resolveMaps()}],sources:["sourcesService",function(a){return a.resolveSources()}]}}).when("/sources/:sourceId",{templateUrl:"views/global-layout.html",controller:"SourceCtrl",resolve:{source:["sourcesService",function(a){return a.resolveCurrentSource()}],maps:["mapsService",function(a){return a.resolveMaps()}],sources:["sourcesService",function(a){return a.resolveSources()}]}}).when("/providers",{templateUrl:"views/providers.html",controller:"ProvidersCtrl"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"],a.interceptors.push("errorsHandler")}]).run(["$localStorage","providerService",function(a,b){b.currentProvider=a.currentProvider}]).run(["$rootScope","$location","$route","providerService",function(a,b,c,d){d.selectWebApiProvider({url:"https://mapapi.apispark.net/v1/",readonly:!0,secured:!1})}]),angular.module("mapManagerApp").controller("ProvidersCtrl",["$scope","$location","providerService",function(a,b,c){if(a.providers={inmemory:{},browserstorage:{},webapi:{url:"",readonly:!0,secured:!1,username:"",password:""}},c.isWebApiCurrentProvider()){var d=c.getCurrentProvider();a.providers.webapi.url=d.url,a.providers.webapi.readonly=d.readonly,a.providers.webapi.secured=d.secured,a.providers.webapi.username=d.username,a.providers.webapi.password=d.password}a.shouldBeSecuredWebApiProvider=function(){return a.providers.webapi.secured},a.selectInMemoryProvider=function(){c.selectInMemoryProvider(a.providers.inmemory),b.path("/")},a.selectBrowserStorageProvider=function(){c.selectBrowserStorageProvider(a.providers.browserstorage),b.path("/")},a.selectWebApiProvider=function(){c.selectWebApiProvider(a.providers.webapi),b.path("/")}}]),angular.module("mapManagerApp").controller("CheckExpressionCtrl",["$scope","$modalInstance","valueChecker","expression","linkedSources","sourceId","rootObject","description","domain","attribute","commonsService","expressionService",function(a,b,c,d,e,f,g,h,i,j,k,l){k.registerCommonPanelFunctionsInScope(a,"expression");var m='[{name:"test1"},{name:"test2"}]',n='["name"]';if(c.isNotNull(f)&&c.isNotNull(e)){var o=_.find(e,"id",f);c.isNotNull(o)&&c.isNotNull(o.sample)&&(m=o.sample,n=o.structure)}a.expression={domain:i,attribute:j,structure:n,data:m,rootObject:g,value:d,description:h,parameters:l.getExpressionParameterDescriptions(),result:""},a.checkExpression=function(){var b=l.parseExpression(a.expression.data),d=b();c.isNotNullAndNotEmpty(a.expression.rootObject)&&(d=d.objects[a.expression.rootObject],"GeometryCollection"===d.type&&(d=d.geometries));try{var e=l.parseExpression(a.expression.value),f=null;if(c.isNotNull(a.expression.context)){var g=l.parseExpression(a.expression.context);f=l.evaluateExpression(g)}if(_.isArray(d)){var h=[];_.forEach(d,function(a,b){h.push(l.evaluateExpression(e,a,b,f))}),a.expression.result=JSON.stringify(h,null,2)}else{var i=l.evaluateExpression(e,d,0,f);a.expression.result=JSON.stringify(i,null,2)}a.expression.success=!0}catch(j){a.expression.result=j.message,a.expression.success=!1}},a.updateExpression=function(){b.close(a.expression.value)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("mapManagerApp").controller("MapCtrl",["$scope","$modal","currentMapService","layerService","projectionService","consoleService","mapCreatorService","map","mapLayers","maps","sources","commonsService","toaster",function(a,b,c,d,e,f,g,h,i,j,k,l,m){l.registerCommonFunctionsInScope(a,b,"map",j,k),h.layers=i,c.setCurrentMap(h),c.getCurrentMapContext().properties={scale:h.scale,center:{lon:h.center.lon,lat:h.center.lat},clipAngle:h.clipAngle},l.setCurrentMapInScope(a,h),l.registerCommonMapFunctionsInScope(a),a.openAddLayerDialog=function(c){var d=b.open({animation:!1,templateUrl:"views/modals/add-layer-modal.html",controller:"AddLayerCtrl"});d.result.then(function(b){a.selected=b,console.log("end")},function(){console.log("Modal dismissed at: "+new Date)}),c.stopPropagation()},a.openImportSourceDialog=function(d){var e=b.open({animation:!1,templateUrl:"views/modals/import-source-modal.html",controller:"ImportSourceCtrl",resolve:{sources:function(){return k}}});e.result.then(function(b){null==a.linkedSources&&(a.linkedSources=[]),a.linkedSources.push(b),m.pop("success",'Map "'+c.currentMap.name+'"',"Successfully imported source")},function(){console.log("Modal dismissed at: "+new Date)}),d.stopPropagation()}}]).controller("AddMapCtrl",["$scope","$modalInstance","commonsService",function(a,b,c){c.registerCommonPanelFunctionsInScope(a),a.mapToAdd={type:"d3"},a.addMap=function(){b.close(a.mapToAdd)},a.cancel=function(){b.dismiss("cancel")}}]).controller("AddSourceCtrl",["$scope","$modalInstance","commonsService","topojsonService","typeHelper",function(a,b,c,d,e){c.registerCommonPanelFunctionsInScope(a),a.shouldDisplayStructure=function(){return"data"===a.sourceToAdd.type},a.sourceToAdd={id:"15",name:"test",type:"data"},a.$watch("sourceToAdd.url",function(b,c){b!==c&&(_.endsWith(b,".tsv")?a.sourceToAdd.dataType="tsv":_.endsWith(b,".csv")?a.sourceToAdd.dataType="csv":_.endsWith(b,".json")&&(a.sourceToAdd.dataType="json"))}),a.loadData=function(){var b=null;"json"===a.sourceToAdd.dataType?b=d3.json:"csv"===a.sourceToAdd.dataType?b=d3.csv:"tsv"===a.sourceToAdd.dataType&&(b=d3.tsv),null!=b&&b(a.sourceToAdd.url,function(b){if("data"===a.sourceToAdd.type){var c=[];if(!_.isEmpty(b))for(var f in b[0])c.push({name:f,type:e.getType(b[0][f])});var g={};_.forEach(c,function(a){if("integer"===a.type||"float"===a.type||"date"===a.type){g[a.name]=[];var c=_.min(b,function(b){return"integer"===a.type?e.parseIntegerValue(b[a.name]):"float"===a.type?e.parseFloatValue(b[a.name]):"date"===a.type?e.parseDateValue(b[a.name]):b[a.name]});g[a.name].push(c[a.name]);var d=_.max(b,function(b){return"integer"===a.type?e.parseIntegerValue(b[a.name]):"float"===a.type?e.parseFloatValue(b[a.name]):"date"===a.type?e.parseDateValue(b[a.name]):b[a.name]});g[a.name].push(d[a.name])}}),a.sourceToAdd.structure=JSON.stringify(c,null,2),a.sourceToAdd.rowNumber=b.length,a.sourceToAdd.minMax=JSON.stringify(g,null,2);var h=_.slice(b,0,5);a.sourceToAdd.sample=JSON.stringify(h,null,2)}else"map"===a.sourceToAdd.type&&(d.transformTopojson(b),_.forEach(b.objects,function(a,b){"GeometryCollection"===a.type&&(a.geometries=_.slice(a.geometries,0,5))}),a.sourceToAdd.sample=JSON.stringify(b,null,2))})},a.addSource=function(){console.log(">> $scope.sourceToAdd = "+JSON.stringify(a.sourceToAdd,null,2)),b.close(a.sourceToAdd)},a.cancel=function(){b.dismiss("cancel")}}]).controller("UpdatePropertiesCtrl",["$scope","commonsService",function(a,b){b.registerCommonPanelFunctionsInScope(a,"initial")}]).controller("UpdateLayerCtrl",["$scope","$modal","commonsService","valueChecker",function(a,b,c,d){c.registerCommonPanelFunctionsInScope(a),c.registerCommonMapLayerFunctionsInScope(a,b),c.registerCommonMapLayerPanelFunctionsInScope(a),d.isNotNull(a.layer.display)&&d.isNotNull(a.layer.display.shape)&&(d.isNotNull(a.layer.display.shape.threshold)?a.layer.display.shape.fillMode="threshold":d.isNotNull(a.layer.display.shape.choropleth)?a.layer.display.shape.fillMode="choropleth":a.layer.display.shape.fillMode="static",a.selectBrewColors=function(b,c){a.layer.display.shape.threshold.paletteCode=b.name,a.layer.display.shape.threshold.paletteReverse=c,
a.layer.display.shape.threshold.colors=b.colors}),d.isNotNull(a.layer.display)&&d.isNotNull(a.layer.display.fill)&&(d.isNotNull(a.layer.display.fill.threshold)?a.layer.display.fill.fillMode="threshold":d.isNotNull(a.layer.display.fill.choropleth)?a.layer.display.fill.fillMode="choropleth":a.layer.display.fill.fillMode="static",a.selectBrewColors=function(b,c){a.layer.display.fill.threshold.paletteCode=b.name,a.layer.display.fill.threshold.paletteReverse=c,a.layer.display.fill.threshold.colors=b.colors})}]).controller("AddLayerCtrl",["$scope","$modalInstance","commonsService",function(a,b,c){c.registerCommonPanelFunctionsInScope(a),c.registerCommonMapLayerPanelFunctionsInScope(a),a.layerToAdd={},a.addLayer=function(){b.close()},a.cancel=function(){b.dismiss("cancel")},a.$watch("layerToAdd.type",function(b,c){c!==b&&("data"===b?a.displayLayerMode():a.hideLayerMode())})}]).controller("ImportSourceCtrl",["$scope","$modalInstance","commonsService","sources",function(a,b,c,d){c.registerCommonPanelFunctionsInScope(a),c.registerCommonMapSourcePanelFunctionsInScope(a),a.layerToAdd={},a.sources=d,a.preview={enabled:!1},a.selectedSource={id:""},a.sourcePreview={},a.$watch("selectedSource.id",function(b,c){b!==c&&(a.sourcePreview=_.find(d,"id",b))}),a.shouldDisplaySourcePreview=function(){return a.preview.enabled},a.importSource=function(){a.sourcePreview=_.find(d,"id",a.selectedSource.id),b.close(a.sourcePreview)},a.cancel=function(){b.dismiss("cancel")}}]).controller("UpdateSourceCtrl",["$scope","commonsService",function(a,b){b.registerCommonPanelFunctionsInScope(a,"preview")}]),angular.module("mapManagerApp").controller("HomeCtrl",["$scope","$modal","maps","sources","commonsService",function(a,b,c,d,e){e.registerCommonFunctionsInScope(a,b,"home",c,d)}]),angular.module("mapManager.templates",[]).run(["$templateCache",function(a){"use strict";a.put("views/directives/form-field-multi-labels-template.html",'<div class="form-group form-group-sm" ng-class="{\'has-error\':isError}"><label for={{for}} class="col-sm-5 control-label text-left" ng-class="{\'required\':req}" style="padding-right: 5px"><span class="label label-default styles">{{label1}}</span>&nbsp;<span class="label label-info styles">{{label2}}</span></label><div class=col-sm-6 style="padding-left: 5px"><span ng-transclude></span> <span class=help-inline ng-show=isError>{{error}}</span></div></div>'),a.put("views/directives/form-field-template.html",'<div class="form-group form-group-sm" ng-class="{\'has-error\':isError}"><label for={{for}} class="col-sm-3 control-label" ng-class="{\'required\':req}" style="padding-right: 5px">{{label}}</label><div class=col-sm-8 style="padding-left: 5px"><span ng-transclude></span> <span class=help-inline ng-show=isError>{{error}}</span></div></div>'),a.put("views/global-layout.html",'<div class=header><div class="navbar navbar-default" role=navigation><div class=container><div class=navbar-header><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#js-navbar-collapse><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand href="#/">Map Visualization</a></div><div class="collapse navbar-collapse" id=js-navbar-collapse><ul class="nav navbar-nav"><li class=dropdown><a data-toggle=dropdown class=dropdown-toggle>Maps <b class=caret></b></a><ul class=dropdown-menu><li ng-repeat="map in maps"><a href=/#/maps/{{map.id}}>{{map.name}}</a></li><li class=divider></li><li><a ng-click=openAddMapDialog()>Create new map</a></li></ul></li><li class=dropdown><a data-toggle=dropdown class=dropdown-toggle>Sources <b class=caret></b></a><ul class=dropdown-menu><li class=dropdown-header>Map sources</li><li ng-repeat="source in mapSources = (sources | filter: { type: \'map\' })"><a href=/#/sources/{{source.id}}>{{source.name}}</a></li><li class=divider></li><li class=dropdown-header>Data sources</li><li ng-repeat="source in mapSources = (sources | filter: { type: \'data\' })"><a href=/#/sources/{{source.id}}>{{source.name}}</a></li><li class=divider></li><li><a ng-click=openAddSourceDialog()>Create new source</a></li></ul></li></ul></div></div></div></div><div ng-if=shoudDisplayHome()><ng-include src="\'views/home.html\'"></ng-include></div><div ng-if=shoudDisplayMap()><ng-include src="\'views/map.html\'"></ng-include></div>'),a.put("views/home.html",""),a.put("views/layer-toolbar.html",'<div ng-click=$event.stopPropagation(); class="pull-right btn-group btn-group-xs" dropdown><a dropdown-toggle><i tooltip=Tools class="glyphicon glyphicon-cog grey-icon"></i></a><ul class=dropdown-menu role=menu><li><a href=#>UI mode <span class=dropdown-menu-right><i class="glyphicon glyphicon-ok grey-icon"></i></span></a></li><li><a href=#>JSON mode</a></li><li role=separator class=divider></li><li class=dropdown-header>Display areas</li><li><a href=#>Shape <span ng-if=shouldDisplayShapeArea(layer) class=dropdown-menu-right><i class="glyphicon glyphicon-ok grey-icon"></i></span></a></li><li><a href=#>Legend <span ng-if=shouldDisplayLegendArea(layer) class=dropdown-menu-right><i class="glyphicon glyphicon-ok grey-icon"></i></span></a></li><li><a href=#>Tooltip <span ng-if=shouldDisplayTooltipArea(layer) class=dropdown-menu-right><i class="glyphicon glyphicon-ok grey-icon"></i></span></a></li><li role=separator class=divider></li><li class=dropdown-header>Behavior areas</li><li><a href=#>Events</a></li><li><a href=#>Animation</a></li></ul></div><div ng-click=$event.stopPropagation(); class="pull-right btn-group btn-group-xs" dropdown><i tooltip="Remove the layer" class="glyphicon glyphicon-remove grey-icon"></i></div><div ng-click=$event.stopPropagation(); class="pull-right btn-group btn-group-xs" dropdown><i tooltip="Save the layer" class="glyphicon glyphicon-save-file grey-icon"></i></div><div ng-click=$event.stopPropagation(); class="pull-right btn-group btn-group-xs" dropdown auto-close=always><a dropdown-toggle><i tooltip="Refresh / Reload layer" class="glyphicon glyphicon-refresh grey-icon"></i></a><ul class=dropdown-menu role=menu><li><a href=# ng-click="refreshLayerApplying($event, layer);">Refresh layer</a></li><li><a href=#>Reload layer</a></li></ul></div><div class="pull-right separator"></div><div ng-click=$event.stopPropagation(); class=pull-right><span class="label label-success" ng-click="toggleLayerApplying($event, layer)"><span ng-if=layer.applied>Applied</span><span ng-if=!layer.applied>Not applied</span></span> <span ng-if=!isLayerWithFillMode(layer) class="label label-primary" ng-click="toggleLayerVisibility($event, layer)"><span ng-if=layer.visible>Visible</span><span ng-if=!layer.visible>Hidden</span></span></div>'),a.put("views/layers/layer-behavior-animation.html",'<div class=behaviorAnimation ng-show="shouldDisplayElementArea(layer, \'behavior\', \'animation\')"><legend>Animation<div class=pull-right><span ng-click="removeElementArea(layer, \'behavior\', \'animation\')" class="glyphicon glyphicon-remove" aria-hidden=true></span></div></legend><field label=Value><div class=input-group ng-if=shoudDisplayCheckExpression(layer.data.source)><input class="form-control input-sm" name=value required ng-model=layer.behavior.animation.value ng-model-options="{ updateOn: \'blur\' }"> <span class=input-group-addon><a ng-click="checkExpression(layer.behavior.animation, \'value\', linkedSources, layer.data.source, layer.data.rootObject, layer.behavior.animation.value, \'Define value used for animation.\')"><i class="glyphicon glyphicon-pencil"></i></a></span></div><input ng-if=!shoudDisplayCheckExpression(layer.data.source) class="form-control input-sm" name=value required ng-model=layer.behavior.animation.value ng-model-options="{ updateOn: \'blur\' }"></field><field label=Label><div class=input-group ng-if=shoudDisplayCheckExpression(layer.data.source)><input class="form-control input-sm" name=label required ng-model=layer.behavior.animation.label ng-model-options="{ updateOn: \'blur\' }"> <span class=input-group-addon><a ng-click="checkExpression(layer.behavior.animation, \'label\', linkedSources, layer.data.source, layer.data.rootObject, layer.behavior.animation.label, \'Define label to display for animation.\')"><i class="glyphicon glyphicon-pencil"></i></a></span></div><input ng-if=!shoudDisplayCheckExpression(layer.data.source) class="form-control input-sm" name=label required ng-model=ayer.behavior.animation.label ng-model-options="{ updateOn: \'blur\' }"></field><field label=Interval><input class="form-control input-sm" name=interval required ng-model=layer.behavior.animation.interval ng-model-options="{ updateOn: \'blur\' }"></field><field label=Ascending><input class=checkbox type=checkbox ng-model="layer.display.legend.ascending"></field><field label="Start value"><input class="form-control input-sm" name=startValue required ng-model=layer.behavior.animation.startValue ng-model-options="{ updateOn: \'blur\' }"></field><field label="Show all at end"><input class=checkbox type=checkbox ng-model="layer.display.legend.showAllAtEnd"></field></div>'),a.put("views/layers/layer-behavior-events.html",'<div class=behaviorEvents ng-show="shouldDisplayElementArea(layer, \'behavior\', \'events\')"><legend>Events<div class=pull-right><span ng-click="removeElementArea(layer, \'behavior\', \'events\')" class="glyphicon glyphicon-remove" aria-hidden=true></span></div></legend><div ng-if="isArray(layer.behavior.events[\'click\'])"><div ng-repeat="event in layer.behavior.events[\'click\']"><field label=Click ng-repeat="(key, value) in event"><input value="{{key}}:{{value}}"></field></div></div><div ng-if="!isArray(layer.behavior.events[\'click\'])"><field label=Click ng-repeat="(key, value) in layer.behavior.events[\'click\']"><input value="{{key}}:{{value}}"></field></div><div ng-if="isArray(layer.behavior.events[\'mouseover\'])"><div ng-repeat="event in layer.behavior.events[\'mouseover\']"><field label="Mouse over" ng-repeat="(key, value) in event"><input value="{{key}}:{{value}}"></field></div></div><div ng-if="!isArray(layer.behavior.events[\'mouseover\'])"><field label="Mouse over" ng-repeat="(key, value) in layer.behavior.events[\'mouseover\']"><input value="{{key}}:{{value}}"></field></div><div ng-if="isArray(layer.behavior.events[\'mouseout\'])"><div ng-repeat="event in layer.behavior.events[\'mouseout\']"><field label="Mouse out" ng-repeat="(key, value) in event"><input value="{{key}}:{{value}}"></field></div></div><div ng-if="!isArray(layer.behavior.events[\'mouseout\'])"><field label="Mouse out" ng-repeat="(key, value) in layer.behavior.events[\'mouseout\']"><input value="{{key}}:{{value}}"></field></div></div>'),a.put("views/layers/layer-data.html",'<form name=dataForm novalidate class=form-horizontal><field label="From source"><select class="form-control input-sm" name=source ng-model=layer.data.source ng-model-options="{ updateOn: \'blur\' }"><option value={{linkedSource.id}} ng-selected="linkedSource.id === layer.data.source" ng-repeat="linkedSource in linkedSources">{{linkedSource.name}}</option></select></field><field label=URL><input class="form-control input-sm" name=name required ng-model=layer.data.url ng-model-options="{ updateOn: \'blur\' }"></field><field label=Type><input class="form-control input-sm" name=applyOn required ng-model=layer.data.type ng-model-options="{ updateOn: \'blur\' }"></field><field label=Inline><textarea class="form-control input-sm" name=inline type=text required ng-model=layer.data.inline ng-model-options="{ updateOn: \'blur\' }"></textarea></field><field label=Where><div class=input-group ng-if=shoudDisplayCheckExpression(layer.data.source)><input class="form-control input-sm" name=where required ng-model=layer.data.where ng-model-options="{ updateOn: \'blur\' }"> <span class=input-group-addon><a ng-click="checkExpression(layer.data, \'where\', linkedSources, layer.data.source, \'\', layer.data.where, \'Filter a collection. The expression must return true or false. If the returned value is false, the element will be removed from the collection.\')"><i class="glyphicon glyphicon-pencil"></i></a></span></div><input ng-if=!shoudDisplayCheckExpression(layer.data.source) class="form-control input-sm" name=where required ng-model=layer.data.where ng-model-options="{ updateOn: \'blur\' }"></field><field label="Sort field"><input class="form-control input-sm" name=orderField required ng-model=layer.data.order.field ng-model-options="{ updateOn: \'blur\' }"></field><field label=Ascending><input class=checkbox type=checkbox ng-model="layer.data.order.ascending"></field></form>'),a.put("views/layers/layer-display-fill.html",'<div class=displayFill ng-show="shouldDisplayElementArea(layer, \'display\', \'fill\')"><legend>Fill<div class=pull-right><span ng-click="removeElementArea(layer, \'display\', \'fill\')" class="glyphicon glyphicon-remove" aria-hidden=true></span></div></legend><field label=Opacity><input class="form-control input-sm" name=opacity required ng-model=layer.display.fill.opacity ng-model-options="{ updateOn: \'blur\' }"></field><field label="Fill mode"><select class="form-control input-sm" name=fillMode ng-model=layer.display.fill.fillMode><option value=static>Static</option><option value=threshold>Threshold</option><option value=choropleth>Choropleth</option></select></field><div ng-if="layer.display.fill.fillMode === \'static\'"><field label=Color><input colorpicker class="form-control input-sm" name=color required ng-model=layer.display.shape.color ng-model-options="{ updateOn: \'blur\' }"></field></div><div ng-if="layer.display.fill.fillMode === \'threshold\'"><field label=Palette><palette-picker initial-name={{layer.display.fill.threshold.paletteCode}} initial-range={{layer.display.fill.threshold.values.length}} initial-reverse=false on-select="selectBrewColors(item, isReverse)"></field><field label="Palette code"><input class="form-control input-sm" name=paletteCode disabled ng-model=layer.display.fill.threshold.paletteCode ng-model-options="{ updateOn: \'blur\' }"></field><field label=Reverse><input class=checkbox type=checkbox ng-model="layer.display.fill.threshold.paletteReverse"></field><field label="Values (Range)"><input class="form-control input-sm" ng-list name=values required ng-model=layer.display.fill.threshold.values ng-model-options="{ updateOn: \'blur\' }"></field><field label="Colors (Range)"><input class="form-control input-sm" ng-list name=colors disabled ng-model=layer.display.fill.threshold.colors ng-model-options="{ updateOn: \'blur\' }"></field><field label=Value><div class=input-group ng-if=shoudDisplayCheckExpression(layer.data.source)><input class="form-control input-sm" name=value required ng-model=layer.display.fill.value ng-model-options="{ updateOn: \'blur\' }"> <span class=input-group-addon><a ng-click="checkExpression(layer.display.fill, \'value\', linkedSources, layer.data.source, layer.data.rootObject, layer.display.fill.value, \'Define value. The expression must return a number that will be used define the color of the fill.\')"><i class="glyphicon glyphicon-pencil"></i></a></span></div><input ng-if=!shoudDisplayCheckExpression(layer.data.source) class="form-control input-sm" name=value required ng-model=layer.display.fill.value ng-model-options="{ updateOn: \'blur\' }"></field></div></div>'),a.put("views/layers/layer-display-legend.html",'<div class=displayLegend ng-show="shouldDisplayElementArea(layer, \'display\', \'legend\')"><legend>Legend<div class=pull-right><span ng-click="removeElementArea(layer, \'display\', \'legend\')" class="glyphicon glyphicon-remove" aria-hidden=true></span></div></legend><field label=Enabled><input class=checkbox type=checkbox ng-model="layer.display.legend.enabled"></field><field label=Label><div class=input-group ng-if=shoudDisplayCheckExpression(layer.data.source)><input class="form-control input-sm" name=value required ng-model=layer.display.legend.label ng-model-options="{ updateOn: \'blur\' }"> <span class=input-group-addon><a ng-click="checkExpression(layer.display.legend, \'label\', linkedSources, layer.data.source, layer.data.rootObject, layer.display.legend.label, \'Define legend label.\')"><i class="glyphicon glyphicon-pencil"></i></a></span></div><input ng-if=!shoudDisplayCheckExpression(layer.data.source) class="form-control input-sm" name=label required ng-model=layer.display.legend.label ng-model-options="{ updateOn: \'blur\' }"></field></div>'),a.put("views/layers/layer-display-shape-circle.html",'<field label=Radius><div class=input-group ng-if=shoudDisplayCheckExpression(layer.data.source)><input class="form-control input-sm" name=radius required ng-model=layer.display.shape.radius ng-model-options="{ updateOn: \'blur\' }"> <span class=input-group-addon><a ng-click="checkExpression(layer.display.shape, \'radius\', linkedSources, layer.data.source, \'\', layer.display.shape.radius, \'Define shape radius. The expression must return a number.\')"><i class="glyphicon glyphicon-pencil"></i></a></span></div><input ng-if=!shoudDisplayCheckExpression(layer.data.source) class="form-control input-sm" name=radius required ng-model=layer.display.shape.radius ng-model-options="{ updateOn: \'blur\' }"></field><field label=Origin><div class=input-group ng-if=shoudDisplayCheckExpression(layer.data.source)><input class="form-control input-sm" name=origin required ng-model=layer.display.shape.origin ng-model-options="{ updateOn: \'blur\' }"> <span class=input-group-addon><a ng-click="checkExpression(layer.display.shape, \'radius\', linkedSources, layer.data.source, \'\', layer.display.shape.origin, \'Define shape origin. The expression must return an array with two values (longitude and latitude).\')"><i class="glyphicon glyphicon-pencil"></i></a></span></div><input ng-if=!shoudDisplayCheckExpression(layer.data.source) class="form-control input-sm" name=origin required ng-model=layer.display.shape.origin ng-model-options="{ updateOn: \'blur\' }"></field><field label=Opacity><input class="form-control input-sm" name=opacity required ng-model=layer.display.shape.opacity ng-model-options="{ updateOn: \'blur\' }"></field><field label="Fill mode"><select class="form-control input-sm" name=fillMode ng-model=layer.display.shape.fillMode><option value=static>Static</option><option value=threshold>Threshold</option><option value=choropleth>Choropleth</option></select></field><div ng-if="layer.display.shape.fillMode === \'static\'"><field label=Color><input colorpicker class="form-control input-sm" name=color required ng-model=layer.display.shape.color ng-model-options="{ updateOn: \'blur\' }"></field></div><div ng-if="layer.display.shape.fillMode === \'threshold\'"><field label=Palette><palette-picker initial-name={{layer.display.shape.threshold.paletteCode}} initial-range={{layer.display.shape.threshold.values.length}} initial-reverse=false on-select="selectBrewColors(item, isReverse)"></field><field label="Palette code"><input class="form-control input-sm" name=paletteCode disabled ng-model=layer.display.shape.threshold.paletteCode ng-model-options="{ updateOn: \'blur\' }"></field><field label=Reverse><input class=checkbox type=checkbox ng-model="layer.display.shape.threshold.paletteReverse"></field><field label="Values (Range)"><input class="form-control input-sm" ng-list name=values required ng-model=layer.display.shape.threshold.values ng-model-options="{ updateOn: \'blur\' }"></field><field label="Colors (Range)"><input class="form-control input-sm" ng-list name=colors disabled ng-model=layer.display.shape.threshold.colors ng-model-options="{ updateOn: \'blur\' }"></field><field label=Value><div class=input-group ng-if=shoudDisplayCheckExpression(layer.data.source)><input class="form-control input-sm" name=value required ng-model=layer.display.shape.value ng-model-options="{ updateOn: \'blur\' }"> <span class=input-group-addon><a ng-click="checkExpression(layer.display.shape, \'value\', linkedSources, layer.data.source, layer.data.rootObject, layer.display.shape.value, \'Define value. The expression must return a number that will be used define the color of the shape.\')"><i class="glyphicon glyphicon-pencil"></i></a></span></div><input ng-if=!shoudDisplayCheckExpression(layer.data.source) class="form-control input-sm" name=value required ng-model=layer.display.shape.value ng-model-options="{ updateOn: \'blur\' }"></field></div>'),a.put("views/layers/layer-display-shape-line.html",'<field label=Value><div class=input-group ng-if=shoudDisplayCheckExpression(layer.data.source)><input class="form-control input-sm" name=value required ng-model=layer.display.shape.value ng-model-options="{ updateOn: \'blur\' }"> <span class=input-group-addon><a ng-click="checkExpression(layer.display.shape, \'value\', linkedSources, layer.data.source, layer.data.rootObject, layer.display.shape.value, \'Define value. The expression must return a number that will be used define the color of the shape.\')"><i class="glyphicon glyphicon-pencil"></i></a></span></div><input ng-if=!shoudDisplayCheckExpression(layer.data.source) class="form-control input-sm" name=value required ng-model=layer.display.shape.value ng-model-options="{ updateOn: \'blur\' }"></field><field label="Point value"><div class=input-group ng-if=shoudDisplayCheckExpression(layer.data.source)><input class="form-control input-sm" name=pointValue required ng-model=layer.display.shape.pointValue ng-model-options="{ updateOn: \'blur\' }"> <span class=input-group-addon><a ng-click="checkExpression(layer.display.shape, \'pointValue\', linkedSources, layer.data.source, layer.data.rootObject, layer.display.shape.pointValue, \'Define value. The expression must return a number that will be used define the color of the shape.\')"><i class="glyphicon glyphicon-pencil"></i></a></span></div><input ng-if=!shoudDisplayCheckExpression(layer.data.source) class="form-control input-sm" name=pointValue required ng-model=layer.display.shape.pointValue ng-model-options="{ updateOn: \'blur\' }"></field>'),a.put("views/layers/layer-display-shape-polygon.html","layer-display-shape-polygon.html"),a.put("views/layers/layer-display-shape-square.html","layer-display-shape-square.html"),a.put("views/layers/layer-display-shape.html","<div class=displayShape ng-show=\"shouldDisplayElementArea(layer, 'display', 'shape')\"><legend>Shape<div class=pull-right><span ng-click=\"removeElementArea(layer, 'display', 'shape')\" class=\"glyphicon glyphicon-remove\" aria-hidden=true></span></div></legend><field label=Shape><select class=\"form-control input-sm\" name=type ng-model=layer.display.shape.type><option value=circle>Circle</option><option value=polygon>Polygon</option><option value=square>Square</option><option value=line>Line</option></select></field><div ng-if=shouldDisplayDataCircleProperties(layer)><ng-include src=\"'views/layers/layer-display-shape-circle.html'\"></ng-include></div><div ng-if=shouldDisplayDataPolygonProperties(layer)><ng-include src=\"'views/layers/layer-display-shape-polygon.html'\"></ng-include></div><div ng-if=shouldDisplayDataSquareProperties(layer)><ng-include src=\"'views/layers/layer-display-shape-square.html'\"></ng-include></div><div ng-if=shouldDisplayDataLineProperties(layer)><ng-include src=\"'views/layers/layer-display-shape-line.html'\"></ng-include></div></div>"),a.put("views/layers/layer-display-tooltip.html",'<div class=displayTooltip ng-show="shouldDisplayElementArea(layer, \'display\', \'tooltip\')"><legend>Tooltip<div class=pull-right><span ng-click="removeDisplayElementArea(layer, \'display\', \'tooltip\')" class="glyphicon glyphicon-remove" aria-hidden=true></span></div></legend><field label=Enabled><input class=checkbox type=checkbox ng-model="layer.display.tooltip.enabled"></field><field label=Text><div class=input-group ng-if=shoudDisplayCheckExpression(layer.data.source)><input class="form-control input-sm" name=value required ng-model=layer.display.tooltip.text ng-model-options="{ updateOn: \'blur\' }"> <span class=input-group-addon><a ng-click="checkExpression(layer.display.tooltip, \'value\', linkedSources, layer.data.source, layer.data.rootObject, layer.display.tooltip.text, \'Define tooltip text.\')"><i class="glyphicon glyphicon-pencil"></i></a></span></div><input ng-if=!shoudDisplayCheckExpression(layer.data.source) class="form-control input-sm" name=text required ng-model=layer.display.tooltip.text ng-model-options="{ updateOn: \'blur\' }"></field></div>'),a.put("views/layers/layer-fill-data.html",'<form name=dataForm novalidate class=form-horizontal><field label=URL><input class="form-control input-sm" name=name required ng-model=layer.data.url ng-model-options="{ updateOn: \'blur\' }"></field><field label=Type><input class="form-control input-sm" name=applyOn required ng-model=layer.data.type ng-model-options="{ updateOn: \'blur\' }"></field></form>'),a.put("views/layers/layer-fill-display.html","<form name=displayForm novalidate class=form-horizontal><ng-include src=\"'views/layers/layer-display-fill.html'\"></ng-include></form>"),a.put("views/layers/layer-fill-properties.html",'<form name=propertiesForm novalidate class=form-horizontal><field label=Name><input class="form-control input-sm" name=name required ng-model=layer.name ng-model-options="{ updateOn: \'blur\' }"></field><field label=Type><input class="form-control input-sm" name=type disabled ng-model=layer.type ng-model-options="{ updateOn: \'blur\' }"></field><field label=Mode><input class="form-control input-sm" name=mode disabled ng-model=layer.mode ng-model-options="{ updateOn: \'blur\' }"></field><field label="Apply on layer"><select class="form-control input-sm" name=applyOn ng-model=layer.applyOn><option ng-repeat="optionLayer in filteredLayers = (layers | filter: {id: \'!layer.id\'})" ng-selected="optionLayer.id === layer.applyOn" value={{optionLayer.id}}>{{optionLayer.name}}</option></select></field></form>'),a.put("views/layers/layer-fill-tabs.html",'<div class=text-center><div class=btn-group role=group><button type=button ng-click="displayPanel(\'properties\')" ng-class="{active: isDisplayedPanel(\'properties\')}" class="btn btn-default">Properties</button> <button type=button ng-click="displayPanel(\'data\')" ng-class="{active: isDisplayedPanel(\'data\')}" class="btn btn-default">Data</button> <button type=button ng-click="displayPanel(\'display\')" ng-class="{active: isDisplayedPanel(\'display\')}" class="btn btn-default">Display</button></div></div>'),a.put("views/layers/layer-geodata-behavior.html","<form name=animationForm novalidate class=form-horizontal><ng-include src=\"'views/layers/layer-behavior-events.html'\"></ng-include><ng-include src=\"'views/layers/layer-behavior-animation.html'\"></ng-include></form>"),a.put("views/layers/layer-geodata-data.html","<ng-include src=\"'views/layers/layer-data.html'\"></ng-include>"),a.put("views/layers/layer-geodata-display.html","<form name=displayForm novalidate class=form-horizontal><ng-include src=\"'views/layers/layer-display-tooltip.html'\"></ng-include></form>"),a.put("views/layers/layer-geodata-properties.html",'<form name=layerForm novalidate class=form-horizontal><field label=Name><input class="form-control input-sm" name=name required ng-model=layer.name ng-model-options="{ updateOn: \'blur\' }"></field><field label=Type><input class="form-control input-sm" name=type disabled ng-model=layer.type ng-model-options="{ updateOn: \'blur\' }"></field></form>'),a.put("views/layers/layer-geodata-styles.html",'<div ng-show="shouldDisplayPanel(\'styles\')" class=layer-description-area><form name=stylesForm novalidate class=form-horizontal><div class=stylesBackground><legend>Background</legend><field label=fill><input colorpicker class="form-control input-sm" name=scale required ng-model=layer.styles.background.fill ng-model-options="{ updateOn: \'blur\' }"></field></div><div class=stylesLine><legend>Line</legend><field label=Stroke><input colorpicker class="form-control input-sm" name=scale placeholder=Scale required ng-model=layer.styles.lines.stroke ng-model-options="{ updateOn: \'blur\' }"></field><field label="Stroke width"><input class="form-control input-sm" name=scale placeholder=Scale required ng-model=layer.styles.lines.strokeWidth ng-model-options="{ updateOn: \'blur\' }"></field><field label="Stroke opacity"><input class="form-control input-sm" name=scale placeholder=Scale required ng-model=layer.styles.lines.strokeOpacity ng-model-options="{ updateOn: \'blur\' }"></field></div></form></div>'),a.put("views/layers/layer-geodata-tabs.html",'<div class=text-center><div class=btn-group role=group><button type=button ng-click="displayPanel(\'properties\')" ng-class="{active: isDisplayedPanel(\'properties\')}" class="btn btn-default">Properties</button> <button type=button ng-click="displayPanel(\'data\')" ng-class="{active: isDisplayedPanel(\'data\')}" class="btn btn-default">Data</button> <button type=button ng-click="displayPanel(\'display\')" ng-class="{active: isDisplayedPanel(\'display\')}" class="btn btn-default">Display</button> <button type=button ng-click="displayPanel(\'styles\')" ng-class="{active: isDisplayedPanel(\'styles\')}" class="btn btn-default">Styles</button> <button type=button ng-click="displayPanel(\'behavior\')" ng-class="{active: isDisplayedPanel(\'behavior\')}" class="btn btn-default">Behavior</button></div></div>'),a.put("views/layers/layer-graticule-properties.html",'<form name=layerForm novalidate class=form-horizontal><field label=Name><input class="form-control input-sm" name=name required ng-model=layer.name ng-model-options="{ updateOn: \'blur\' }"></field><field label=Type><input class="form-control input-sm" name=type disabled ng-model=layer.type ng-model-options="{ updateOn: \'blur\' }"></field><field label="Apply on layer"><select class="form-control input-sm" name=applyOn ng-model=layer.applyOn><option ng-repeat="optionLayer in filteredLayers = (layers | filter: {id: \'!layer.id\'})" value={{optionLayer.id}}>{{optionLayer.name}}</option></select></field><field label=Background><input class=checkbox type=checkbox ng-model=layer.display.background></field><field label=Lines><input class=checkbox type=checkbox ng-model=layer.display.lines></field><field label=Border><input class=checkbox type=checkbox ng-model=layer.display.border></field></form>'),a.put("views/layers/layer-graticule-styles.html",'<form name=stylesForm novalidate class=form-horizontal><div class=stylesBackground><legend>Background</legend><field label=Fill><input colorpicker class="form-control input-sm" name=scale required ng-model=layer.styles.background.fill ng-model-options="{ updateOn: \'blur\' }"></field></div><div class=stylesBorder><legend>Border</legend><field label=Stroke><input colorpicker class="form-control input-sm" name=scale required ng-model=layer.styles.border.stroke ng-model-options="{ updateOn: \'blur\' }"></field><field label="Stroke width"><input class="form-control input-sm" name=scale placeholder=Scale required ng-model=layer.styles.border.strokeWidth ng-model-options="{ updateOn: \'blur\' }"></field></div><div class=stylesLine><legend>Line</legend><field label=Stroke><input colorpicker class="form-control input-sm" name=scale placeholder=Scale required ng-model=layer.styles.lines.stroke ng-model-options="{ updateOn: \'blur\' }"></field><field label="Stroke Width"><input class="form-control input-sm" name=scale placeholder=Scale required ng-model=layer.styles.lines.strokeWidth ng-model-options="{ updateOn: \'blur\' }"></field><field label="Stroke opacity"><input class="form-control input-sm" name=scale placeholder=Scale required ng-model=layer.styles.lines.strokeOpacity ng-model-options="{ updateOn: \'blur\' }"></field></div></form>'),a.put("views/layers/layer-graticule-tabs.html",'<div class=text-center><div class=btn-group role=group><button type=button ng-click="displayPanel(\'properties\')" ng-class="{active: isDisplayedPanel(\'properties\')}" class="btn btn-default">Properties</button> <button type=button ng-click="displayPanel(\'styles\')" ng-class="{active: isDisplayedPanel(\'styles\')}" class="btn btn-default">Styles</button></div></div>'),
a.put("views/layers/layer-object-behavior.html","<form name=animationForm novalidate class=form-horizontal><ng-include src=\"'views/layers/layer-behavior-events.html'\"></ng-include><ng-include src=\"'views/layers/layer-behavior-animation.html'\"></ng-include></form>"),a.put("views/layers/layer-object-data.html","<ng-include src=\"'views/layers/layer-data.html'\"></ng-include>"),a.put("views/layers/layer-object-display.html","<form name=displayForm novalidate class=form-horizontal><ng-include src=\"'views/layers/layer-display-shape.html'\"></ng-include><ng-include src=\"'views/layers/layer-display-legend.html'\"></ng-include><ng-include src=\"'views/layers/layer-display-tooltip.html'\"></ng-include></form>"),a.put("views/layers/layer-object-properties.html",'<form name=propertiesForm novalidate class=form-horizontal><field label=Name><input class="form-control input-sm" name=name required ng-model=layer.name ng-model-options="{ updateOn: \'blur\' }"></field><field label=Type><input class="form-control input-sm" name=type disabled ng-model=layer.type ng-model-options="{ updateOn: \'blur\' }"></field><field label=Mode><input class="form-control input-sm" name=mode disabled ng-model=layer.mode ng-model-options="{ updateOn: \'blur\' }"></field></form>'),a.put("views/layers/layer-object-tabs.html",'<div class=text-center><div class=btn-group role=group><button type=button ng-click="displayPanel(\'properties\')" ng-class="{active: isDisplayedPanel(\'properties\')}" class="btn btn-default">Properties</button> <button type=button ng-click="displayPanel(\'data\')" ng-class="{active: isDisplayedPanel(\'data\')}" class="btn btn-default">Data</button> <button type=button ng-click="displayPanel(\'display\')" ng-class="{active: isDisplayedPanel(\'display\')}" class="btn btn-default">Display</button> <button type=button ng-click="displayPanel(\'behavior\')" ng-class="{active: isDisplayedPanel(\'behavior\')}" class="btn btn-default">Behavior</button></div></div>'),a.put("views/layers/layer-toolbar.html",'<div ng-click=$event.stopPropagation(); class="pull-right btn-group btn-group-xs" dropdown><a dropdown-toggle><i tooltip=Tools class="glyphicon glyphicon-cog grey-icon"></i></a><ul class=dropdown-menu role=menu><li><a href=#>UI mode <span class=dropdown-menu-right><i class="glyphicon glyphicon-ok grey-icon"></i></span></a></li><li><a href=#>JSON mode</a></li><li role=separator class=divider></li><li class=dropdown-header>Display areas</li><li><a href=#>Shape <span ng-if="shouldDisplayElementArea(layer, \'display\', \'shape\')" class=dropdown-menu-right><i class="glyphicon glyphicon-ok grey-icon"></i></span></a></li><li><a href=#>Legend <span ng-if="shouldDisplayElementArea(layer, \'display\', \'legend\')" class=dropdown-menu-right><i class="glyphicon glyphicon-ok grey-icon"></i></span></a></li><li><a href=#>Tooltip <span ng-if="shouldDisplayElementArea(layer, \'display\', \'tooltip\')" class=dropdown-menu-right><i class="glyphicon glyphicon-ok grey-icon"></i></span></a></li><li role=separator class=divider></li><li class=dropdown-header>Behavior areas</li><li><a href=#>Events <span ng-if="shouldDisplayElementArea(layer, \'behavior\', \'events\')" class=dropdown-menu-right><i class="glyphicon glyphicon-ok grey-icon"></i></span></a></li><li><a href=#>Animation <span ng-if="shouldDisplayElementArea(layer, \'behavior\', \'animation\')" class=dropdown-menu-right><i class="glyphicon glyphicon-ok grey-icon"></i></span></a></li></ul></div><div ng-click=$event.stopPropagation(); class="pull-right btn-group btn-group-xs" dropdown><i tooltip="Remove the layer" class="glyphicon glyphicon-remove grey-icon"></i></div><div ng-click=$event.stopPropagation(); class="pull-right btn-group btn-group-xs" dropdown><i tooltip="Save the layer" class="glyphicon glyphicon-save-file grey-icon"></i></div><div ng-click=$event.stopPropagation(); class="pull-right btn-group btn-group-xs" dropdown auto-close=always><a dropdown-toggle><i tooltip="Refresh / Reload layer" class="glyphicon glyphicon-refresh grey-icon"></i></a><ul class=dropdown-menu role=menu><li><a href=# ng-click="refreshLayerApplying($event, layer);">Refresh layer</a></li><li><a href=#>Reload layer</a></li></ul></div><div class="pull-right separator"></div><div ng-click=$event.stopPropagation(); class=pull-right><span class="label label-success" ng-click="toggleLayerApplying($event, layer)"><span ng-if=layer.applied>Applied</span><span ng-if=!layer.applied>Not applied</span></span> <span ng-if=!isLayerWithFillMode(layer) class="label label-primary" ng-click="toggleLayerVisibility($event, layer)"><span ng-if=layer.visible>Visible</span><span ng-if=!layer.visible>Hidden</span></span></div>'),a.put("views/map.html",'<div><div class=col-md-8 id=map map=map></div><div class=col-md-4><nav class="navbar navbar-default map-bar"><div class=container-fluid><div class=navbar-header><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#bs-example-navbar-collapse-1 aria-expanded=false><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand href=#>{{mapName}}</a></div><div class="collapse navbar-collapse" id=bs-example-navbar-collapse-1><ul class="nav navbar-nav navbar-left"><li ng-if="mapType===\'d3js\'" class=active><a>D3</a></li><li ng-if="mapType===\'googlemaps\'" class=active><a>GMaps</a></li><li class=divider-vertical></li></ul><ul class="nav navbar-nav navbar-right"><li><a><i tooltip="Refresh the map" ng-click="" class="glyphicon glyphicon-refresh grey-icon"></i> Refresh</a></li><li><a><i tooltip="Export map structure" ng-click="" class="glyphicon glyphicon-export grey-icon"></i> Export</a></li></ul></div></div></nav><accordion close-others=oneAtATime><accordion-group is-open=status.isFirstOpen is-disabled=status.isFirstDisabled><accordion-heading>Properties</accordion-heading><div ng-controller=UpdatePropertiesCtrl><ng-include src="\'views/map/map-properties-tabs.html\'"></ng-include><div ng-show="shouldDisplayPanel(\'initial\')" class=layer-description-area><ng-include src="\'views/map/map-properties-initial.html\'"></ng-include></div><div ng-show="shouldDisplayPanel(\'current\')" class=layer-description-area><ng-include src="\'views/map/map-properties-current.html\'"></ng-include></div></div></accordion-group><accordion-group><accordion-heading>Layers <i tooltip="Add a layer" ng-click=openAddLayerDialog($event) class="pull-right glyphicon glyphicon-plus grey-icon"></i></accordion-heading><accordion close-others=oneAtATime><accordion-group ng-repeat="layer in layers"><accordion-heading>{{layer.name}}<ng-include src="\'views/layers/layer-toolbar.html\'"></ng-include></accordion-heading><div ng-if=shouldDisplayGraticuleProperties(layer) ng-controller=UpdateLayerCtrl><ng-include src="\'views/layers/layer-graticule-tabs.html\'"></ng-include><div ng-show="shouldDisplayPanel(\'properties\')" class=layer-description-area><ng-include src="\'views/layers/layer-graticule-properties.html\'"></ng-include></div><div ng-show="shouldDisplayPanel(\'styles\')" class=layer-description-area><ng-include src="\'views/layers/layer-graticule-styles.html\'"></ng-include></div></div><div ng-if=shouldDisplayGeoDataProperties(layer) ng-controller=UpdateLayerCtrl><ng-include src="\'views/layers/layer-geodata-tabs.html\'"></ng-include><div ng-show="shouldDisplayPanel(\'properties\')" class=layer-description-area><ng-include src="\'views/layers/layer-geodata-properties.html\'"></ng-include></div><div ng-show="shouldDisplayPanel(\'data\')" class=layer-description-area><ng-include src="\'views/layers/layer-geodata-data.html\'"></ng-include></div><div ng-show="shouldDisplayPanel(\'display\')" class=layer-description-area><ng-include src="\'views/layers/layer-geodata-display.html\'"></ng-include></div><div ng-if=shouldDisplayGeoDataStylesProperties(layer)><ng-include src="\'views/layers/layer-geodata-styles.html\'"></ng-include></div><div ng-show="shouldDisplayPanel(\'behavior\')" class=layer-description-area><ng-include src="\'views/layers/layer-geodata-behavior.html\'"></ng-include></div></div><div ng-if=shouldDisplayDataFillProperties(layer) ng-controller=UpdateLayerCtrl><ng-include src="\'views/layers/layer-fill-tabs.html\'"></ng-include><div ng-show="shouldDisplayPanel(\'properties\')" class=layer-description-area><ng-include src="\'views/layers/layer-fill-properties.html\'"></ng-include></div><div ng-show="shouldDisplayPanel(\'data\')" class=layer-description-area><ng-include src="\'views/layers/layer-fill-data.html\'"></ng-include></div><div ng-show="shouldDisplayPanel(\'display\')" class=layer-description-area><ng-include src="\'views/layers/layer-fill-display.html\'"></ng-include></div></div><div ng-if=shouldDisplayDataObjectsProperties(layer) ng-controller=UpdateLayerCtrl><ng-include src="\'views/layers/layer-object-tabs.html\'"></ng-include><div ng-show="shouldDisplayPanel(\'properties\')" class=layer-description-area><ng-include src="\'views/layers/layer-object-properties.html\'"></ng-include></div><div ng-show="shouldDisplayPanel(\'data\')" class=layer-description-area><ng-include src="\'views/layers/layer-object-data.html\'"></ng-include></div><div ng-show="shouldDisplayPanel(\'display\')" class=layer-description-area><ng-include src="\'views/layers/layer-object-display.html\'"></ng-include></div><div ng-show="shouldDisplayPanel(\'behavior\')" class=layer-description-area><ng-include src="\'views/layers/layer-object-behavior.html\'"></ng-include></div></div></accordion-group></accordion></accordion-group><accordion-group is-open=status.open><accordion-heading>Sources <i tooltip="Import a source" ng-click=openImportSourceDialog($event) class="pull-right glyphicon glyphicon-import grey-icon"></i></accordion-heading><accordion close-others=oneAtATime><accordion-group ng-repeat="source in linkedSources"><accordion-heading>{{source.name}}</accordion-heading><div ng-controller=UpdateSourceCtrl><ng-include src="\'views/map/map-sources-tabs.html\'"></ng-include><div ng-show="shouldDisplayPanel(\'preview\')" class=layer-description-area><ng-include src="\'views/map/map-sources-preview.html\'"></ng-include></div><div ng-show="shouldDisplayPanel(\'properties\')" class=layer-description-area><ng-include src="\'views/map/map-sources-properties.html\'"></ng-include></div></div></accordion-group></accordion></accordion-group><accordion-group><accordion-heading>Interactions</accordion-heading><form name=interactionsForm novalidate class=form-horizontal><field label=Move><select class="form-control input-sm" name=moving ng-model=interactions.moving><option value="">None</option><option value=mouseMove>With mouse move</option></select></field><field label=Zoom><select class="form-control input-sm" name=zooming ng-model=interactions.zooming><option value="">None</option><option value=mouseWheel>With mouse wheel</option></select></field></form></accordion-group><accordion-group is-open=status.open><accordion-heading>Console</accordion-heading><ul><li ng-repeat="message in messages">{{message.description}}</li></ul></accordion-group></accordion></div></div>'),a.put("views/map/map-properties-current.html",'<form name=propertiesForm novalidate class=form-horizontal><field label=Scale><input disabled class="form-control input-sm" name=scale placeholder=Scale required ng-model="currentProperties.scale"></field><field label="Center (lon)"><input disabled class="form-control input-sm" name=lon placeholder="Center (longitude)" required ng-model="currentProperties.center.lon"></field><field label="Center (lat)"><input disabled class="form-control input-sm" name=lat placeholder="Center (latitude)" required ng-model="currentProperties.center.lat"></field></form>'),a.put("views/map/map-properties-initial.html",'<form name=propertiesForm novalidate class=form-horizontal><field label=Projection><select class="form-control input-sm" name=projection ng-model=properties.projection><option value=none>None</option><option value=orthographic>Orthographic</option><option value=mercator>Mercator</option><option value=satellite>Satellite</option></select></field><field label=Scale><input class="form-control input-sm" name=scale placeholder=Scale required ng-model="properties.scale"></field><field label="Center (lon)"><input class="form-control input-sm" name=centerLon placeholder="Center (longitude)" required ng-model="properties.center.lon"></field><field label="Center (lat)"><input class="form-control input-sm" name=centerLat placeholder="Center (latitude)" required ng-model="properties.center.lat"></field></form>'),a.put("views/map/map-properties-tabs.html",'<div class=text-center><div class=btn-group role=group><button type=button ng-click="displayPanel(\'initial\')" ng-class="{active: isDisplayedPanel(\'initial\')}" class="btn btn-default">Initial</button> <button type=button ng-click="displayPanel(\'current\')" ng-class="{active: isDisplayedPanel(\'current\')}" class="btn btn-default">Current</button></div></div>'),a.put("views/map/map-sources-preview.html",'<form name=previewSourceForm novalidate class=form-horizontal><field label=Structure><textarea class="form-control input-sm" name=structure row=5 disabled>{{source.structure}}</textarea></field><field label=Samples><textarea class="form-control input-sm" name=name row=5 disabled>{{source}}</textarea></field></form>'),a.put("views/map/map-sources-properties.html",'<form name=previewSourceForm novalidate class=form-horizontal><field label=Name><input class="form-control input-sm" name=name disabled value="{{source.name}}"></field><field label="Data type"><input class="form-control input-sm" name=type row=5 disabled value="{{source.type}}"></field><field label="Data URL"><input class="form-control input-sm" name=originUrl row=5 disabled value="{{source.url}}"></field><field label="Origin URL"><input class="form-control input-sm" name=originUrl row=5 disabled value="{{source.originUrl}}"></field></form>'),a.put("views/map/map-sources-tabs.html",'<div class=text-center><div class=btn-group role=group><button type=button ng-click="displayPanel(\'preview\')" ng-class="{active: isDisplayedPanel(\'preview\')}" class="btn btn-default">Preview</button> <button type=button ng-click="displayPanel(\'properties\')" ng-class="{active: isDisplayedPanel(\'properties\')}" class="btn btn-default">Properties</button></div></div>'),a.put("views/modals/add-layer-modal.html",'<div class="modal-header small"><h4>Add a layer</h4></div><div class=modal-body><div class=text-center><div class=btn-group role=group><button type=button ng-click="displayPanel(\'properties\')" ng-class="{active: isDisplayedPanel(\'properties\')}" class="btn btn-default">Properties</button> <button type=button ng-click="displayPanel(\'data\')" ng-class="{active: isDisplayedPanel(\'data\')}" class="btn btn-default">Data</button> <button type=button ng-click="displayPanel(\'display\')" ng-class="{active: isDisplayedPanel(\'display\')}" class="btn btn-default">Display</button> <button type=button ng-click="displayPanel(\'styles\')" ng-class="{active: isDisplayedPanel(\'styles\')}" class="btn btn-default">Styles</button></div></div><div ng-show="shouldDisplayPanel(\'properties\')" class=layer-description-area><form name=addLayerForm novalidate class=form-horizontal><field label=Name><input class="form-control input-sm" name=name required ng-model=layerToAdd.name ng-model-options="{ updateOn: \'blur\' }"></field><field label=Type><select class="form-control input-sm" name=name ng-model=layerToAdd.type><option value=geodata>Geo data</option><option value=data>Data</option><option value=graticule>Graticule</option></select></field><field ng-if=shoudDisplayLayerMode() label=Mode><select class="form-control input-sm" name=name ng-model=layerToAdd.mode ng-model-options="{ updateOn: \'blur\' }"><option value=shape>Shape</option><option value=fill>Fill</option></select></field><field label="Apply on layer"><input class="form-control input-sm" name=applyOn required ng-model=layerToAdd.applyOn ng-model-options="{ updateOn: \'blur\' }"></field></form></div><div ng-show="shouldDisplayPanel(\'styles\') && layerToAdd.type === \'geodata\'" class=layer-description-area><form name=stylesForm novalidate class=form-horizontal><field-multi-labels label1=path label2=fill><input colorpicker class="form-control input-sm" name=scale required ng-model=layer.styles.path.fill ng-model-options="{ updateOn: \'blur\' }"></field-multi-labels><field-multi-labels label1=path label2=stroke><input colorpicker class="form-control input-sm" name=stroke required ng-model=layer.styles.path.stroke ng-model-options="{ updateOn: \'blur\' }"></field-multi-labels><field-multi-labels label1=path label2=strokeLinejoin><input class="form-control input-sm" name=strokeLinejoin required ng-model=layer.styles.path.strokeLinejoin ng-model-options="{ updateOn: \'blur\' }"></field-multi-labels><field-multi-labels label1=path label2=strokeLinecap><input class="form-control input-sm" name=strokeLinecap required ng-model=layer.styles.path.strokeLinecap ng-model-options="{ updateOn: \'blur\' }"></field-multi-labels><field-multi-labels label1=d label2=strokeWidth><input class="form-control input-sm" name=strokeWidth required ng-model=layer.styles.d.strokeWidth ng-model-options="{ updateOn: \'blur\' }"></field-multi-labels></form></div></div><div class="modal-footer small"><button class="btn btn-primary" ng-click=addLayer()>Add</button> <button class=btn ng-click=cancel()>Cancel</button></div>'),a.put("views/modals/add-map-modal.html",'<div class="modal-header small"><h4>Add a map</h4></div><div class=modal-body><div class=text-center><div class=btn-group role=group><button type=button ng-click="displayPanel(\'properties\')" ng-class="{active: isDisplayedPanel(\'properties\')}" class="btn btn-default">Properties</button></div></div><div ng-show="shouldDisplayPanel(\'properties\')" class=layer-description-area><form name=addLayerForm novalidate class=form-horizontal><field label=Name><input class="form-control input-sm" name=name required ng-model=mapToAdd.name ng-model-options="{ updateOn: \'blur\' }"></field><field label=Type><select class="form-control input-sm" name=dataType ng-model=mapToAdd.type><option value=d3>D3</option><option value=googlemaps>Google Maps</option></select></field></form></div></div><div class="modal-footer small"><button class="btn btn-primary" ng-click=addMap()>Add</button> <button class=btn ng-click=cancel()>Cancel</button></div>'),a.put("views/modals/add-source-modal.html",'<div class="modal-header small"><h4>Add a source</h4></div><div class=modal-body><div class=text-center><div class=btn-group role=group><button type=button ng-click="displayPanel(\'properties\')" ng-class="{active: isDisplayedPanel(\'properties\')}" class="btn btn-default">Properties</button> <button type=button ng-click="displayPanel(\'data\')" ng-class="{active: isDisplayedPanel(\'data\')}" class="btn btn-default">Data</button> <button type=button ng-click="displayPanel(\'structure\')" ng-class="{active: isDisplayedPanel(\'structure\')}" class="btn btn-default">Struture</button></div></div><div ng-show="shouldDisplayPanel(\'properties\')" class=layer-description-area><form name=propertiesForm novalidate class=form-horizontal><field label=Name><input class="form-control input-sm" name=name required ng-model=sourceToAdd.name ng-model-options="{ updateOn: \'blur\' }"></field><field label=Type><select class="form-control input-sm" name=type ng-model=sourceToAdd.type><option value=data>Data</option><option value=map>Map</option></select></field></form></div><div ng-show="shouldDisplayPanel(\'data\')" class=layer-description-area><form name=dataForm novalidate class=form-horizontal><field label=URL><div class=input-group><input class="form-control input-sm" name=url required ng-model=sourceToAdd.url ng-model-options="{ updateOn: \'blur\' }"> <span class=input-group-addon><a ng-click=loadData()><i class="glyphicon glyphicon-download"></i></a></span></div></field><field label="Data type"><select class="form-control input-sm" name=dataType ng-model=sourceToAdd.dataType><option value=csv>CSV</option><option value=tsv>TSV</option><option value=json>JSON</option></select></field></form></div><div ng-show="shouldDisplayPanel(\'structure\')" class=layer-description-area><form name=structureForm novalidate class=form-horizontal><div ng-if=shouldDisplayStructure()><field label=Structure><textarea class="form-control input-sm" name=structure rows=4 required ng-model=sourceToAdd.structure ng-model-options="{ updateOn: \'blur\' }">\n          </textarea></field><field label="Row number"><input class="form-control input-sm" name=rowNumber required ng-model=sourceToAdd.rowNumber ng-model-options="{ updateOn: \'blur\' }"></field><field label="Min / max"><textarea class="form-control input-sm" name=rowNumber rows=4 required ng-model=sourceToAdd.minMax ng-model-options="{ updateOn: \'blur\' }">\n          </textarea></field><field label=Sample><textarea class="form-control input-sm" name=sample rows=10 required ng-model=sourceToAdd.sample ng-model-options="{ updateOn: \'blur\' }">\n          </textarea></field></div><div ng-if=!shouldDisplayStructure()><field label=Sample><textarea class="form-control input-sm" name=sample rows=10 required ng-model=sourceToAdd.sample ng-model-options="{ updateOn: \'blur\' }">\n          </textarea></field></div></form></div></div><div class="modal-footer small"><button class="btn btn-primary" ng-click=addSource()>Add</button> <button class=btn ng-click=cancel()>Cancel</button></div>'),a.put("views/modals/expression-check-modal.html",'<div class="modal-header small"><h4>Check expression "{{expression.attribute}}"</h4></div><div class=modal-body><div class=text-center><div class=btn-group role=group><button type=button ng-click="displayPanel(\'structure\')" ng-class="{active: isDisplayedPanel(\'structure\')}" class="btn btn-default">Structure</button> <button type=button ng-click="displayPanel(\'data\')" ng-class="{active: isDisplayedPanel(\'data\')}" class="btn btn-default">Data</button> <button type=button ng-click="displayPanel(\'context\')" ng-class="{active: isDisplayedPanel(\'context\')}" class="btn btn-default">Context</button> <button type=button ng-click="displayPanel(\'expression\')" ng-class="{active: isDisplayedPanel(\'expression\')}" class="btn btn-default">Expression</button></div></div><form name=expressionForm novalidate class=form-horizontal><div ng-show="shouldDisplayPanel(\'structure\')" class=layer-description-area><field label=Structure><textarea row=10 class="form-control input-sm structure" name=structure disabled ng-model=expression.structure ng-model-options="{ updateOn: \'blur\' }">\n        </textarea></field></div><div ng-show="shouldDisplayPanel(\'data\')" class=layer-description-area><field label=rootObject><input class="form-control input-sm data" name=rootObject ng-model=expression.rootObject ng-model-options="{ updateOn: \'blur\' }"></field><field label=Data><textarea row=10 class="form-control input-sm data" name=data ng-model=expression.data ng-model-options="{ updateOn: \'blur\' }">\n        </textarea></field><field label="Min / max"><textarea class="form-control input-sm" name=rowNumber rows=4 disabled required ng-model=sourceToAdd.minMax ng-model-options="{ updateOn: \'blur\' }">\n        </textarea></field></div><div ng-show="shouldDisplayPanel(\'context\')" class=layer-description-area><field label=Context><textarea row=10 class="form-control input-sm data" name=context ng-model=expression.context ng-model-options="{ updateOn: \'blur\' }">\n        </textarea></field></div><div ng-show="shouldDisplayPanel(\'expression\')" class=layer-description-area><field label=""><textarea row=6 disabled class="form-control input-sm description" name=data>{{expression.description}}</textarea></field><field label=""><textarea row=6 disabled class="form-control input-sm parameters" name=data>{{expression.parameters}}</textarea></field><field label=Expression><div class=input-group><input class="form-control input-sm" name=expression required ng-model=expression.value ng-model-options="{ updateOn: \'blur\' }"> <span class=input-group-addon><a ng-click=checkExpression()><i tooltip="Execute the expression against the sample data" class="glyphicon glyphicon-check"></i></a></span></div></field><field label=Result><textarea row=6 class="form-control input-sm result" name=result disabled ng-model=expression.result ng-model-options="{ updateOn: \'blur\' }">\n        </textarea></field></div></form></div><div class="modal-footer small"><button class="btn btn-primary" ng-click=updateExpression()>Update</button> <button class=btn ng-click=cancel()>Cancel</button></div>'),a.put("views/modals/import-source-modal.html",'<div class="modal-header small"><h4>Import a source</h4></div><div class=modal-body><form name=importSourceForm novalidate class=form-horizontal><field label=Sources><select class="form-control input-sm" name=name ng-model=selectedSource.id><option ng-repeat="source in sources" value={{source.id}}>{{source.name}}</option></select></field><field label=Preview><input class=checkbox type=checkbox ng-model=preview.enabled></field></form><div ng-if=shouldDisplaySourcePreview()><fieldset><legend>Source preview</legend><form name=previewSourceForm novalidate class=form-horizontal><field label=Name><input class="form-control input-sm" name=name disabled value="{{sourcePreview.name}}"></field><field label=Structure><textarea class="form-control input-sm" name=structure row=5 disabled>{{sourcePreview.structure}}</textarea></field><field label=Samples><textarea class="form-control input-sm" name=name row=5 disabled>{{sourcePreview}}</textarea></field></form></fieldset></div></div><div class="modal-footer small"><button class="btn btn-primary" ng-click=importSource()>Import</button> <button class=btn ng-click=cancel()>Cancel</button></div>'),a.put("views/providers.html",'<div class=header><div class="navbar navbar-default" role=navigation><div class=container><div class=navbar-header><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#js-navbar-collapse><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand href="#/">Map Visualization</a></div></div></div></div><div class=container><div class="row providers"><h3>Map providers</h3><accordion close-others=oneAtATime><accordion-group heading=In-memory><div class=well>The maps will be stored in memory but all data will be lost when closing or reloading the current page.</div><div class=text-center><button type=button class="btn btn-default" ng-click=selectInMemoryProvider()>Select</button></div></accordion-group><accordion-group heading="Browser storage"><div class=well>The maps will be stored within the browser storage. Data won\'t be lost when closing or reloading the current page. But you won\'t access them using a Web API and share them.</div><div class=text-center><button type=button class="btn btn-default" ng-click=selectBrowserStorageProvider()>Select</button></div></accordion-group><accordion-group heading="Web API"><div class=well>The maps will be stored using a Web API. You will be able to access them using a Web API and share them.</div><form name=providersForm novalidate class=form-horizontal><field label=URL><input class="form-control input-sm" name=url placeholder=URL required ng-model="providers.webapi.url"></field><field label=Read-only><input class=checkbox type=checkbox ng-model=providers.webapi.readonly></field><field label=Secured><input class=checkbox type=checkbox ng-model=providers.webapi.secured></field><div ng-show=shouldBeSecuredWebApiProvider()><field label=Username><input class="form-control input-sm" name=username placeholder=Username required ng-model="providers.webapi.username"></field><field label=Password><input class="form-control input-sm" name=password placeholder=Password required ng-model="providers.webapi.password"></field></div><div class=text-center><button type=button class="btn btn-default" ng-click=selectWebApiProvider()>Select</button></div></form></accordion-group></accordion></div></div>')}]);